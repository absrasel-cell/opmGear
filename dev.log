
> customcap@0.1.0 dev
> next dev

 ‚ö† Port 3000 is in use by process 31900, using available port 3003 instead.
   ‚ñ≤ Next.js 15.4.6
   - Local:        http://localhost:3003
   - Network:      http://10.5.0.2:3003
   - Environments: .env.local, .env

 ‚úì Starting...
 ‚úì Ready in 2.3s
 ‚óã Compiling /api/support-ai ...
 ‚úì Compiled /api/support-ai in 1511ms (292 modules)
üöÄ [PRICING-SERVICE] Ultra-fast pricing service initialized with intelligent caching
‚úÖ Supabase Admin: Using service role key for elevated permissions
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üîç [ANALYZE] Conversation history length: 0
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üí¨ History messages: 0
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 0 messages
üìã [EXTRACT] No structured quote found, using user specifications only
üìã [EXTRACT] Final extracted specifications: { quantity: 0 }
üìã Previous specifications: { quantity: 0 }
üîç [DETECT] Analyzing message for changes: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
üìã [DETECT] Previous specs for comparison: { quantity: 0 }
üî¢ [DETECT] Quantity change detected: 0 -> 144
üî¢ [DETECT] Quantity change detected: 0 -> 144
üîç [DETECT] Total changes detected: 2
üîç Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
üîß [MERGE] Starting with previous specs: { quantity: 0 }
üîß [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
üîß [MERGE] Preserved critical values: { quantity: null, colors: undefined, logos: 0, accessories: 0 }
üîß [MERGE] Applied quantity change: 144
üîß [MERGE] Preserving existing logos: 0
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] Applied quantity change: 144
üîß [MERGE] Preserving existing logos: 0
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 144,
  logos: 0,
  accessories: 0,
  fabric: undefined,
  colors: undefined
}
üîß Merged specifications: { quantity: 144 }
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mol...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: false,
  hasContext: false,
  changesDetected: 2,
  previousQuantity: 0,
  previousLogos: 0,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: false, detectedChanges: 2, mergedSpecs: 1 }
üìù [ENHANCED-CONTEXT] Using contextual message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charg...
üî¢ [QTY-FIX] Using quantity from context: 144
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: false,
  isConversationalUpdate: false,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'quantity', 'quantity' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: false,
  mergedColors: undefined,
  mergedColor: undefined,
  finalColors: [ 'Black' ],
  finalColor: 'Black'
}
üé® [FORMAT8-COLORS] === START EXTRACTING COLOR ===
üé® [FORMAT8-COLORS] Input text: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
üé® [FORMAT8-COLORS] Slash pattern match: [
  'black/white',
  'black',
  'white',
  index: 80,
  input: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.',
  groups: undefined
]
üé® [FORMAT8-COLORS] Split color parts: { part1: 'black', part2: 'white' }
üé® [FORMAT8-COLORS] Color validation: { part1Valid: true, part2Valid: true }
üé® [FORMAT8-COLORS] RESULT: Split color detected: Black/White
üé® [ENHANCED-ANALYZE] Legacy color detection applied: {
  detectedColor: 'Black/White',
  colors: [ 'Black', 'White' ],
  color: 'Black/White'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: undefined Final colors: [ 'Black', 'White' ]
üìè [ADVANCED-SIZE] Standard size detected: { desc: 'medium', hatSize: '7 1/4' }
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: 7 1/4
üö´ [FABRIC-DETECTION] Skipping color pattern: black/white
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: undefined Final fabric: Polyester
üéØ [PANEL-DETECTION] 7-PANEL DETECTED from message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 7P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: null
üîç [UNIFIED-LOGO] Starting unified detection: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üîç [UNIFIED-LOGO] Searching for ALL logo patterns in text...
üéØ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "rubber patch" -> Rubber Patch
üìç [UNIFIED-LOGO] Position detected near "rubber patch" at index 102: Back
üìè [UNIFIED-LOGO] Size detected near "rubber patch" at index 102: Medium
‚úÖ [UNIFIED-LOGO] Added: Rubber Patch at Back (Medium) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "leather patch" -> Leather Patch
üìç [UNIFIED-LOGO] Position detected near "leather patch" at index 155: Front
üìè [UNIFIED-LOGO] Size detected near "leather patch" at index 155: Large
‚úÖ [UNIFIED-LOGO] Added: Leather Patch at Front (Large) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "3d embroidery" -> 3D Embroidery
üìç [UNIFIED-LOGO] Position detected near "3d embroidery" at index 213: Left
üìè [UNIFIED-LOGO] Size detected near "3d embroidery" at index 213: Small
‚úÖ [UNIFIED-LOGO] Added: 3D Embroidery at Left (Small) - Confidence: 0.95
üìç [UNIFIED-LOGO] Position detected near "3d embroidery" at index 245: Right
üìè [UNIFIED-LOGO] Size detected near "3d embroidery" at index 245: Small
‚úÖ [UNIFIED-LOGO] Added: 3D Embroidery at Right (Small) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "embroidery" -> Embroidery
üìç [UNIFIED-LOGO] Position detected near "embroidery" at index 216: Left
‚ö†Ô∏è [UNIFIED-LOGO] Position Left already has logo - skipping duplicate
üìç [UNIFIED-LOGO] Position detected near "embroidery" at index 248: Right
‚ö†Ô∏è [UNIFIED-LOGO] Position Right already has logo - skipping duplicate
üéØ [UNIFIED-LOGO] Final results: {
  totalCount: 4,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ],
  summary: 'Back: Rubber Patch (Medium), Front: Leather Patch (Large), Left: 3D Embroidery (Small), Right: 3D Embroidery (Small)'
}
üé® [LEGACY-ANALYZE] UNIFIED logo detection for new request: {
  totalCount: 4,
  hasLogos: true,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ]
}
üè∑Ô∏è [ACCESSORY-DETECTION] Accessories detected: {
  originalText: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  foundAccessories: []
}
üè∑Ô∏è [LEGACY-ANALYZE] Advanced accessories detection for new request: {
  message: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  detectedAccessories: [],
  uniqueCount: 0
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 144,
    fabric: 'Polyester',
    closure: null,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 144,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: '7 1/4',
  fabric: 'Polyester',
  panelCount: '7P',
  closure: null,
  capSpecifications: { panelCount: '7P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber Patch',
    location: 'Back',
    size: 'Medium',
    hasMoldCharge: true,
    priority: 2
  },
  allLogoRequirements: [
    {
      type: 'Rubber Patch',
      location: 'Back',
      size: 'Medium',
      hasMoldCharge: true,
      priority: 2
    },
    {
      type: 'Leather Patch',
      location: 'Front',
      size: 'Large',
      hasMoldCharge: true,
      priority: 1
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: false,
    isConversationalUpdate: false,
    isQuantityUpdate: false,
    detectedChanges: [ [Object], [Object] ],
    mergedSpecifications: { quantity: 144 },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: false,
    closurePreserved: false,
    logosPreserved: false,
    accessoriesPreserved: false
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 144
üí∞ [BLANK-CAP] Panel count requirement: 7P
üí∞ [BLANK-CAP] User bill shape input: null
üîß [PRICING-SERVICE] Loading products from Supabase...
üîß [PRICING-SERVICE] Initializing Supabase client: {
  url: 'https://tfiemrpfsvxv...',
  hasServiceKey: true,
  hasAnonKey: true,
  usingKey: 'SERVICE_ROLE'
}
‚úÖ [PRICING-SERVICE] Supabase client initialized successfully
‚úÖ [PRICING-SERVICE] Supabase client obtained
üîç [PRICING-SERVICE] Query executed, checking results...
üìä [PRICING-SERVICE] Raw query result: 77 products
üìã [PRICING-SERVICE] Sample product: {
  name: '4P Visor Cap MSCS',
  code: '4P_VISOR_CAP_MSCS',
  has_pricing_tier: true,
  tier_name: 'Tier 1'
}
‚úÖ [PRICING-SERVICE] Successfully loaded 77 products from Supabase
‚úÖ [PRICING-SERVICE] Loaded 3 pricing tiers from Supabase
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 7P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 7-Panel detected -> Tier 3 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 3
üéØ [PRODUCT-SELECT] Found 13 products in Tier 3 : [
  '7P CrownFrame 7 LFF',
  '7P CrownFrame 7 LFS',
  '7P CrownFrame 7 MSCF',
  '7P CrownFrame 7 MSCS',
  '7P Elite Seven HFS',
  '7P Elite Seven HSCF',
  '7P Elite Seven HSCS',
  '7P Elite Seven LSCS',
  '7P Elite Seven MFS',
  '7P FlatFrame 7 HSCS',
  '7P Summit Seven HFF',
  '7P Summit Seven LSCF',
  '7P Summit Seven MFF'
]
üéØ [PRODUCT-SELECT] Selected Elite Seven product: 7P Elite Seven HFS
üéØ [BLANK-CAP] Final product selection: {
  name: '7P Elite Seven HFS',
  code: '7P_ELITE_SEVEN_HFS',
  databaseTier: 'Tier 3',
  businessTier: 'Tier 3',
  panelCount: 7,
  databaseBillShape: 'Flat',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '7P Elite Seven HFS',
  tier: 'Tier 3',
  unitPrice: 4.25,
  totalCost: 612,
  quantity: 144
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '7P Elite Seven HFS',
  productCode: '7P_ELITE_SEVEN_HFS',
  panelCount: '7P',
  billShape: 'Flat',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 4.25,
  totalCost: 612,
  pricingTier: 'Tier 3',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Flat',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
‚úÖ [PRICING-SERVICE] Loaded 19 premium fabrics from Supabase
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber Patch @ Back',
  'Leather Patch @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
‚úÖ [PRICING-SERVICE] Loaded 33 logo methods from Supabase
üé® [LOGO] Processing: Rubber Patch Back Medium (+Mold Charge)
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber Patch" (Medium)
üî• [PRICING-SERVICE] Pre-warming cache with common data...
üîÑ [PRICING-SERVICE] Using cached products: 77 items
‚úÖ [PRICING-SERVICE] Loaded 3 mold charges from Supabase
üí∞ [LOGO] Using database mold charge: Medium = 80 for Rubber Patch
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 80,
  totalWithMold: 494.71999999999997
}
üé® [LOGO] Processing: Leather Patch Front Large (+Mold Charge)
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather Patch" (Large)
üí∞ [LOGO] Using database mold charge: Large = 120 for Leather Patch
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 120,
  totalWithMold: 534.72
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 80,
      totalWithMold: 494.71999999999997
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 120,
      totalWithMold: 534.72
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    }
  ],
  totalCost: 1461.44,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
‚úÖ [PRICING-SERVICE] Loaded 6 accessories from Supabase
‚úÖ [PRICING-SERVICE] Loaded 7 premium closures from Supabase
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $3.75 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $3.63 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.55 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.45 for 2880 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $4 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $3.75 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.63 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.5 for 2880 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $4.25 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $4 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.68 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.6 for 2880 units
‚úÖ [PRICING-SERVICE] Cache pre-warming completed
‚úÖ [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 3.29,
  totalCost: 473.76
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 2547.2, completedSections: 3 }
 POST /api/support-ai 200 in 4317ms
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: change quantity to 600 pieces
üîç [ANALYZE] Conversation history length: 2
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: change quantity to 600 pieces
üí¨ History messages: 2
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 2 messages
üîç [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
üîç [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ..."
üìã [EXTRACT] Found structured quote in message 1
üî¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
üî¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
üî¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
‚ùå [SUPPORT AI - FORMAT #8] Processing failed: TypeError: Cannot read properties of undefined (reading 'trim')
    at ConversationContextService.extractSpecificationsFromQuote (src\lib\support-ai\conversation-context.ts:344:44)
    at ConversationContextService.extractPreviousSpecifications (src\lib\support-ai\conversation-context.ts:213:21)
    at ConversationContextService.buildSmartContextualRequest (src\lib\support-ai\conversation-context.ts:107:37)
    at analyzeCustomerRequirements (src\lib\pricing\format8-functions.ts:678:57)
    at async POST (src\app\api\support-ai\route.ts:56:25)
  342 |       const productMatch = content.match(pattern);
  343 |       if (productMatch) {
> 344 |         specs.productName = productMatch[1].trim();
      |                                            ^
  345 |         console.log('üéØ [EXTRACT] Product from quote:', specs.productName);
  346 |
  347 |         // Extract panel count from product name for preservation
 POST /api/support-ai 500 in 117ms
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: change color to red/blue
üîç [ANALYZE] Conversation history length: 4
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: change color to red/blue
üí¨ History messages: 4
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 4 messages
üîç [EXTRACT-DEBUG] Message 3: role=assistant, content length=178
üîç [EXTRACT-DEBUG] Assistant message preview: "I apologize, but I'm having trouble creating your quote right now. Please try rephrasing your request with specific details like quantity, colors, and customization requirements...."
üîç [EXTRACT-DEBUG] Message 2: role=user, content length=29
üé® [EXTRACT-USER] === START COLOR EXTRACTION ===
üé® [EXTRACT-USER] Input content: change quantity to 600 pieces
üé® [EXTRACT-USER] === END COLOR EXTRACTION ===
üîç [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
üîç [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ..."
üìã [EXTRACT] Found structured quote in message 1
üî¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
üî¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
üî¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
‚ùå [SUPPORT AI - FORMAT #8] Processing failed: TypeError: Cannot read properties of undefined (reading 'trim')
    at ConversationContextService.extractSpecificationsFromQuote (src\lib\support-ai\conversation-context.ts:344:44)
    at ConversationContextService.extractPreviousSpecifications (src\lib\support-ai\conversation-context.ts:213:21)
    at async ConversationContextService.buildSmartContextualRequest (src\lib\support-ai\conversation-context.ts:107:26)
    at async analyzeCustomerRequirements (src\lib\pricing\format8-functions.ts:678:24)
    at async POST (src\app\api\support-ai\route.ts:56:25)
  342 |       const productMatch = content.match(pattern);
  343 |       if (productMatch) {
> 344 |         specs.productName = productMatch[1].trim();
      |                                            ^
  345 |         console.log('üéØ [EXTRACT] Product from quote:', specs.productName);
  346 |
  347 |         // Extract panel count from product name for preservation
 POST /api/support-ai 500 in 68ms
 ‚úì Compiled in 288ms (107 modules)
üöÄ [PRICING-SERVICE] Ultra-fast pricing service initialized with intelligent caching
‚úÖ Supabase Admin: Using service role key for elevated permissions
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üîç [ANALYZE] Conversation history length: 0
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üí¨ History messages: 0
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 0 messages
üìã [EXTRACT] No structured quote found, using user specifications only
üìã [EXTRACT] Final extracted specifications: { quantity: 0 }
üìã Previous specifications: { quantity: 0 }
üîç [DETECT] Analyzing message for changes: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
üìã [DETECT] Previous specs for comparison: { quantity: 0 }
üî¢ [DETECT] Quantity change detected: 0 -> 144
üî¢ [DETECT] Quantity change detected: 0 -> 144
üîç [DETECT] Total changes detected: 2
üîç Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
üîß [MERGE] Starting with previous specs: { quantity: 0 }
üîß [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
üîß [MERGE] Preserved critical values: { quantity: null, colors: undefined, logos: 0, accessories: 0 }
üîß [MERGE] Applied quantity change: 144
üîß [MERGE] Preserving existing logos: 0
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] Applied quantity change: 144
üîß [MERGE] Preserving existing logos: 0
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 144,
  logos: 0,
  accessories: 0,
  fabric: undefined,
  colors: undefined
}
üîß Merged specifications: { quantity: 144 }
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mol...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: false,
  hasContext: false,
  changesDetected: 2,
  previousQuantity: 0,
  previousLogos: 0,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: false, detectedChanges: 2, mergedSpecs: 1 }
üìù [ENHANCED-CONTEXT] Using contextual message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charg...
üî¢ [QTY-FIX] Using quantity from context: 144
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: false,
  isConversationalUpdate: false,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'quantity', 'quantity' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: false,
  mergedColors: undefined,
  mergedColor: undefined,
  finalColors: [ 'Black' ],
  finalColor: 'Black'
}
üé® [FORMAT8-COLORS] === START EXTRACTING COLOR ===
üé® [FORMAT8-COLORS] Input text: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
üé® [FORMAT8-COLORS] Slash pattern match: [
  'black/white',
  'black',
  'white',
  index: 80,
  input: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.',
  groups: undefined
]
üé® [FORMAT8-COLORS] Split color parts: { part1: 'black', part2: 'white' }
üé® [FORMAT8-COLORS] Color validation: { part1Valid: true, part2Valid: true }
üé® [FORMAT8-COLORS] RESULT: Split color detected: Black/White
üé® [ENHANCED-ANALYZE] Legacy color detection applied: {
  detectedColor: 'Black/White',
  colors: [ 'Black', 'White' ],
  color: 'Black/White'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: undefined Final colors: [ 'Black', 'White' ]
üìè [ADVANCED-SIZE] Standard size detected: { desc: 'medium', hatSize: '7 1/4' }
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: 7 1/4
üö´ [FABRIC-DETECTION] Skipping color pattern: black/white
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: undefined Final fabric: Polyester
üéØ [PANEL-DETECTION] 7-PANEL DETECTED from message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 7P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: null
üîç [UNIFIED-LOGO] Starting unified detection: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üîç [UNIFIED-LOGO] Searching for ALL logo patterns in text...
üéØ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "rubber patch" -> Rubber Patch
üìç [UNIFIED-LOGO] Position detected near "rubber patch" at index 102: Back
üìè [UNIFIED-LOGO] Size detected near "rubber patch" at index 102: Medium
‚úÖ [UNIFIED-LOGO] Added: Rubber Patch at Back (Medium) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "leather patch" -> Leather Patch
üìç [UNIFIED-LOGO] Position detected near "leather patch" at index 155: Front
üìè [UNIFIED-LOGO] Size detected near "leather patch" at index 155: Large
‚úÖ [UNIFIED-LOGO] Added: Leather Patch at Front (Large) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "3d embroidery" -> 3D Embroidery
üìç [UNIFIED-LOGO] Position detected near "3d embroidery" at index 213: Left
üìè [UNIFIED-LOGO] Size detected near "3d embroidery" at index 213: Small
‚úÖ [UNIFIED-LOGO] Added: 3D Embroidery at Left (Small) - Confidence: 0.95
üìç [UNIFIED-LOGO] Position detected near "3d embroidery" at index 245: Right
üìè [UNIFIED-LOGO] Size detected near "3d embroidery" at index 245: Small
‚úÖ [UNIFIED-LOGO] Added: 3D Embroidery at Right (Small) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "embroidery" -> Embroidery
üìç [UNIFIED-LOGO] Position detected near "embroidery" at index 216: Left
‚ö†Ô∏è [UNIFIED-LOGO] Position Left already has logo - skipping duplicate
üìç [UNIFIED-LOGO] Position detected near "embroidery" at index 248: Right
‚ö†Ô∏è [UNIFIED-LOGO] Position Right already has logo - skipping duplicate
üéØ [UNIFIED-LOGO] Final results: {
  totalCount: 4,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ],
  summary: 'Back: Rubber Patch (Medium), Front: Leather Patch (Large), Left: 3D Embroidery (Small), Right: 3D Embroidery (Small)'
}
üé® [LEGACY-ANALYZE] UNIFIED logo detection for new request: {
  totalCount: 4,
  hasLogos: true,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ]
}
üè∑Ô∏è [ACCESSORY-DETECTION] Accessories detected: {
  originalText: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  foundAccessories: []
}
üè∑Ô∏è [LEGACY-ANALYZE] Advanced accessories detection for new request: {
  message: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  detectedAccessories: [],
  uniqueCount: 0
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 144,
    fabric: 'Polyester',
    closure: null,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 144,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: '7 1/4',
  fabric: 'Polyester',
  panelCount: '7P',
  closure: null,
  capSpecifications: { panelCount: '7P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber Patch',
    location: 'Back',
    size: 'Medium',
    hasMoldCharge: true,
    priority: 2
  },
  allLogoRequirements: [
    {
      type: 'Rubber Patch',
      location: 'Back',
      size: 'Medium',
      hasMoldCharge: true,
      priority: 2
    },
    {
      type: 'Leather Patch',
      location: 'Front',
      size: 'Large',
      hasMoldCharge: true,
      priority: 1
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: false,
    isConversationalUpdate: false,
    isQuantityUpdate: false,
    detectedChanges: [ [Object], [Object] ],
    mergedSpecifications: { quantity: 144 },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: false,
    closurePreserved: false,
    logosPreserved: false,
    accessoriesPreserved: false
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 144
üí∞ [BLANK-CAP] Panel count requirement: 7P
üí∞ [BLANK-CAP] User bill shape input: null
üîß [PRICING-SERVICE] Loading products from Supabase...
üîß [PRICING-SERVICE] Initializing Supabase client: {
  url: 'https://tfiemrpfsvxv...',
  hasServiceKey: true,
  hasAnonKey: true,
  usingKey: 'SERVICE_ROLE'
}
‚úÖ [PRICING-SERVICE] Supabase client initialized successfully
‚úÖ [PRICING-SERVICE] Supabase client obtained
üîç [PRICING-SERVICE] Query executed, checking results...
üìä [PRICING-SERVICE] Raw query result: 77 products
üìã [PRICING-SERVICE] Sample product: {
  name: '4P Visor Cap MSCS',
  code: '4P_VISOR_CAP_MSCS',
  has_pricing_tier: true,
  tier_name: 'Tier 1'
}
‚úÖ [PRICING-SERVICE] Successfully loaded 77 products from Supabase
‚úÖ [PRICING-SERVICE] Loaded 3 pricing tiers from Supabase
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 7P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 7-Panel detected -> Tier 3 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 3
üéØ [PRODUCT-SELECT] Found 13 products in Tier 3 : [
  '7P CrownFrame 7 LFF',
  '7P CrownFrame 7 LFS',
  '7P CrownFrame 7 MSCF',
  '7P CrownFrame 7 MSCS',
  '7P Elite Seven HFS',
  '7P Elite Seven HSCF',
  '7P Elite Seven HSCS',
  '7P Elite Seven LSCS',
  '7P Elite Seven MFS',
  '7P FlatFrame 7 HSCS',
  '7P Summit Seven HFF',
  '7P Summit Seven LSCF',
  '7P Summit Seven MFF'
]
üéØ [PRODUCT-SELECT] Selected Elite Seven product: 7P Elite Seven HFS
üéØ [BLANK-CAP] Final product selection: {
  name: '7P Elite Seven HFS',
  code: '7P_ELITE_SEVEN_HFS',
  databaseTier: 'Tier 3',
  businessTier: 'Tier 3',
  panelCount: 7,
  databaseBillShape: 'Flat',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '7P Elite Seven HFS',
  tier: 'Tier 3',
  unitPrice: 4.25,
  totalCost: 612,
  quantity: 144
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '7P Elite Seven HFS',
  productCode: '7P_ELITE_SEVEN_HFS',
  panelCount: '7P',
  billShape: 'Flat',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 4.25,
  totalCost: 612,
  pricingTier: 'Tier 3',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Flat',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
‚úÖ [PRICING-SERVICE] Loaded 19 premium fabrics from Supabase
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber Patch @ Back',
  'Leather Patch @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
‚úÖ [PRICING-SERVICE] Loaded 33 logo methods from Supabase
üé® [LOGO] Processing: Rubber Patch Back Medium (+Mold Charge)
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber Patch" (Medium)
üî• [PRICING-SERVICE] Pre-warming cache with common data...
üîÑ [PRICING-SERVICE] Using cached products: 77 items
‚úÖ [PRICING-SERVICE] Loaded 3 mold charges from Supabase
üí∞ [LOGO] Using database mold charge: Medium = 80 for Rubber Patch
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 80,
  totalWithMold: 494.71999999999997
}
üé® [LOGO] Processing: Leather Patch Front Large (+Mold Charge)
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather Patch" (Large)
üí∞ [LOGO] Using database mold charge: Large = 120 for Leather Patch
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 120,
  totalWithMold: 534.72
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 80,
      totalWithMold: 494.71999999999997
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 120,
      totalWithMold: 534.72
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    }
  ],
  totalCost: 1461.44,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [PRICING-SERVICE] Loaded 6 accessories from Supabase
‚úÖ [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
‚úÖ [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 3.29,
  totalCost: 473.76
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 2547.2, completedSections: 3 }
 POST /api/support-ai 200 in 2508ms
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: change quantity to 600 pieces
üîç [ANALYZE] Conversation history length: 2
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: change quantity to 600 pieces
üí¨ History messages: 2
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 2 messages
üîç [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
üîç [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ..."
üìã [EXTRACT] Found structured quote in message 1
üî¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
üî¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
üî¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢(7P\s+Elite\s+Seven\s+HFS\s*\(Tier\s+3\)) match: ‚Ä¢7P Elite Seven HFS (Tier 3)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*(?:Tier\s+\d)?) match: ‚Ä¢7P Elite Seven HFS (Tier 3)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*) match: ‚Ä¢7P Elite Seven HFS (Tier 3)
üßµ [EXTRACT] Fabrics from quote: Polyester
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-‚Äì]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
üé® [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
üé® [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method:"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber: ‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber: $80
‚úÖ [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
üé® [EXTRACT] Processing conversation logo info: "Leather (Large)"
üé® [EXTRACT] Fallback extraction: type="Leather", size="Large"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 "
üí∞ [MOLD-CHARGE] Analyzing match text for Leather: ‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather: $120
‚úÖ [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Left: 3D Embroidery (Small) - $216.00"
üîç [EXTRACT] Full content context (500 chars): "ase cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 ($3.29/cap)

üí∞ **Total Investment: $2547.20**
**Per Cap Cost"
üí∞ [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Right: 3D Embroidery (Small) - $216.00"
üîç [EXTRACT] Full content context (500 chars): "‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 ($3.29/cap)

üí∞ **Total Investment: $2547.20**
**Per Cap Cost: $17.69**

üìä **Cost Breakdown Per Cap:**
‚Ä¢ Base C"
üí∞ [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-‚Äì]\s*(.+?)(?=\n|$)" found 4 matches
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method:"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber (Medium): ‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($494.72 ($2.88/cap + $80.00 mold))
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 "
üí∞ [MOLD-CHARGE] Analyzing match text for Leather (Large): ‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather (Large): $120
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($534.72 ($2.88/cap + $120.00 mold))
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üé® [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "Accessories[^‚Ä¢\n]*\n[\s\S]*?‚Ä¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
üîç [EXTRACT] Accessory pattern "(?:üè∑Ô∏è.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nüöö|\nÔøΩ..." found 0 matches
üîç [EXTRACT] Found 0 accessory mentions in structured quote
üé® [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
üé® [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
üé® [EXTRACT] Testing color pattern "‚Ä¢Color:\s*([^\n]+)...": 1 matches
üé® [EXTRACT] Raw extracted color: Black/White
üé® [EXTRACT] ‚úÖ VALID color from structured quote: Black/White
üé® [EXTRACT] Color found, stopping pattern search
üé® [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
üé® [EXTRACT] Final extracted colors: Black/White
üìä [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
üìä [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
üìä [EXTRACT] Calculated quantity: 612 √∑ 4.25 = 144
üìä [EXTRACT] ‚úÖ VALID quantity from structured quote: 144
üìä [EXTRACT] Quantity found, stopping pattern search
üìä [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
üìä [EXTRACT] Final extracted quantity: 144
üöö [EXTRACT] Delivery from quote: Regular Delivery
üí∞ [EXTRACT] Total cost from quote: 2547.2
üîÑ [EXTRACT] Merging structured quote with user specifications
üîÑ [EXTRACT] Latest complete specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üîÑ [EXTRACT] User-specified changes: { quantity: 0 }
üîÑ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 144
üìã [EXTRACT] Final merged specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üìã Previous specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üîç [DETECT] Analyzing message for changes: change quantity to 600 pieces
üìã [DETECT] Previous specs for comparison: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üî¢ [DETECT] Quantity change detected: 144 -> 600
üîç [DETECT] Total changes detected: 1
üîç Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
üîß [MERGE] Starting with previous specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üîß [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
üîß [MERGE] Preserved critical values: { quantity: 144, colors: 'Black/White', logos: 4, accessories: 0 }
üîß [MERGE] Applied quantity change: 600
üîß [MERGE] Preserving existing logos: 4
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] ULTRA-CRITICAL: Single aspect change detected (quantity) - ENFORCING preservation
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved colors (Black/White)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (2547.2)
üîß [MERGE] SINGLE-ASPECT CHANGE (quantity:quantity) - Ensuring complete preservation
üîß [MERGE] Force-preserved accessories for single-aspect change: []
üîß [MERGE] Final logos preserved: Back:Rubber(Medium), Front:Leather(Large), Left:3D Embroidery(Small), Right:3D Embroidery(Small)
üîß [MERGE] Final accessories preserved: none
üîß [MERGE] Final fabric preserved: Polyester
üîß [MERGE] Final colors preserved: Black/White
üö® [MERGE] QUANTITY-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üö® [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
üö® [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
üö® [MERGE] FORCE-PRESERVED accessories: []
üö® [MERGE] FORCE-PRESERVED colors: Black/White
üö® [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
üö® [MERGE] FORCE-PRESERVED totalCost: 2547.2
üö® [MERGE] FORCE-PRESERVED colors for quantity change: Black/White
üö® [MERGE] FORCE-PRESERVED logos: 4
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Black/White'
}
üîß Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  ‚Ä¢ Back: ...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 144,
  previousLogos: 4,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
üìù [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  ‚Ä¢ Back: ...
üî¢ [QTY-FIX] Using quantity from context: 600
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: true,
  detectedChangeTypes: [ 'quantity' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Black/White',
  mergedColor: 'Black/White',
  finalColors: [ 'Black', 'White' ],
  finalColor: 'Black/White'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: Black/White Final colors: [ 'Black', 'White' ]
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
üéØ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
üé® [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: true,
  preservedContext: {
    fabric: 'PRESERVED',
    closure: 'PRESERVED',
    logos: 'PRESERVED (4)',
    accessories: 'PRESERVED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: true,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Black/White',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 2547.2
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change quantity to 600 pieces"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Black/White\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  ‚Ä¢ Back: Rubber (Medium)\n' +
      '  ‚Ä¢ Front: Leather (Large)\n' +
      '  ‚Ä¢ Left: 3D Embroidery (Small)\n' +
      '  ‚Ä¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $2547.20\n' +
      '\n' +
      'Detected changes:\n' +
      '‚Ä¢ Change quantity from 144 to 600 pieces (Medium confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: true,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 600
üí∞ [BLANK-CAP] Panel count requirement: 6P
üí∞ [BLANK-CAP] User bill shape input: null
üîÑ [PRICING-SERVICE] Using cached products: 77 items
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 6P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 2
üéØ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
üéØ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
üéØ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
üé® [LOGO] Processing: Rubber Back Medium 
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
üí∞ [LOGO] Using preserved mold charge from context: 80 for Rubber
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
üé® [LOGO] Processing: Leather Front Large 
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
üí∞ [LOGO] Using preserved mold charge from context: 120 for Leather
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 32ms
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: change color to red/blue
üîç [ANALYZE] Conversation history length: 4
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: change color to red/blue
üí¨ History messages: 4
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 4 messages
üîç [EXTRACT-DEBUG] Message 3: role=assistant, content length=1239
üîç [EXTRACT-DEBUG] Assistant message preview: "I've updated your quote with the requested changes:

üîÑ **Changes Applied:**
‚Ä¢ Change quantity from 144 to 600 pieces

üí∞ **Cost Impact:** +$6100.80 increase (from $2547.20 to $8648.00)

Here's your d..."
üìã [EXTRACT] Found structured quote in message 3
üî¢ [EXTRACT] Found valid quantity: 2250 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
üî¢ [EXTRACT] Found valid quantity: 600 using pattern: (\d+,?\d*)\s*pieces?
üî¢ [EXTRACT] FINAL selected quantity: 2250 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 2
üî¢ [EXTRACT] All found quantities: [
  '2250 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)',
  '600 ((\\d+,?\\d*)\\s*pieces?)'
]
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢(6P\s+AirFrame\s+HSCS\s*\(Tier\s+2\)) match: ‚Ä¢6P AirFrame HSCS (Tier 2)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*(?:Tier\s+\d)?) match: ‚Ä¢6P AirFrame HSCS (Tier 2)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*) match: ‚Ä¢6P AirFrame HSCS (Tier 2)
üßµ [EXTRACT] Fabrics from quote: Polyester
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-‚Äì]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
üé® [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
üé® [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Metho"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber: ‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber: $80
‚úÖ [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
üé® [EXTRACT] Processing conversation logo info: "Leather (Large)"
üé® [EXTRACT] Fallback extraction: type="Leather", size="Large"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.0"
üí∞ [MOLD-CHARGE] Analyzing match text for Leather: ‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather: $120
‚úÖ [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Left: 3D Embroidery (Small) - $708.00"
üîç [EXTRACT] Full content context (500 chars): " cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.00 ($2.71/cap)

üí∞ **Total Investment: $8648.00**
**Per Cap Cos"
üí∞ [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Right: 3D Embroidery (Small) - $708.00"
üîç [EXTRACT] Full content context (500 chars): "**Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.00 ($2.71/cap)

üí∞ **Total Investment: $8648.00**
**Per Cap Cost: $14.41**

üìä **Cost Breakdown Per Cap:**
‚Ä¢ Base "
üí∞ [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-‚Äì]\s*(.+?)(?=\n|$)" found 4 matches
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Metho"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber (Medium): ‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($1658.00 ($2.63/cap + $80.00 mold))
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.0"
üí∞ [MOLD-CHARGE] Analyzing match text for Leather (Large): ‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather (Large): $120
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($1698.00 ($2.63/cap + $120.00 mold))
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üé® [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "Accessories[^‚Ä¢\n]*\n[\s\S]*?‚Ä¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
üîç [EXTRACT] Accessory pattern "(?:üè∑Ô∏è.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nüöö|\nÔøΩ..." found 0 matches
üîç [EXTRACT] Found 0 accessory mentions in structured quote
üé® [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
üé® [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
üé® [EXTRACT] Testing color pattern "‚Ä¢Color:\s*([^\n]+)...": 1 matches
üé® [EXTRACT] Raw extracted color: Black/White
üé® [EXTRACT] ‚úÖ VALID color from structured quote: Black/White
üé® [EXTRACT] Color found, stopping pattern search
üé® [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
üé® [EXTRACT] Final extracted colors: Black/White
üìä [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
üìä [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
üìä [EXTRACT] Calculated quantity: 2250 √∑ 3.75 = 600
üìä [EXTRACT] ‚úÖ VALID quantity from structured quote: 600
üìä [EXTRACT] Quantity found, stopping pattern search
üìä [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
üìä [EXTRACT] Final extracted quantity: 600
üöö [EXTRACT] Delivery from quote: Regular Delivery
üí∞ [EXTRACT] Total cost from quote: 8648
üîÑ [EXTRACT] Merging structured quote with user specifications
üîÑ [EXTRACT] Latest complete specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üîÑ [EXTRACT] User-specified changes: { quantity: 0 }
üîÑ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 600
üìã [EXTRACT] Final merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üìã Previous specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üîç [DETECT] Analyzing message for changes: change color to red/blue
üìã [DETECT] Previous specs for comparison: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üé® [CONTEXT-SERVICE] === COLOR CHANGE DETECTION ===
üé® [CONTEXT-SERVICE] Previous color: Black/White
üé® [CONTEXT-SERVICE] New color: Red/Blue
üé® [CONTEXT-SERVICE] Colors different?: true
üé® [CONTEXT-SERVICE] RESULT: Color change detected: Black/White -> Red/Blue
üîç [DETECT] Total changes detected: 1
üîç Detected changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
üîß [MERGE] Starting with previous specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üîß [MERGE] Applying changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
üîß [MERGE] Preserved critical values: { quantity: 600, colors: 'Black/White', logos: 4, accessories: 0 }
üé® [CONTEXT-SERVICE] === MERGING COLOR CHANGE ===
üé® [CONTEXT-SERVICE] Previous colors: Black/White
üé® [CONTEXT-SERVICE] New color value: Red/Blue
üé® [CONTEXT-SERVICE] RESULT: Applied color change: Red/Blue
üé® [CONTEXT-SERVICE] Final merged colors: Red/Blue
üîß [MERGE] ULTRA-CRITICAL: Single aspect change detected (colors) - ENFORCING preservation
üîß [MERGE] ULTRA-CRITICAL: Force-preserved quantity (600)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (8648)
üö® [MERGE] COLOR-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
üö® [MERGE] FORCE-PRESERVED quantity: 600
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üö® [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
üö® [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
üö® [MERGE] FORCE-PRESERVED accessories: []
üö® [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
üö® [MERGE] FORCE-PRESERVED totalCost: 8648
üö® [MERGE] FORCE-PRESERVED quantity for color change: 600
üö® [MERGE] FORCE-PRESERVED logos: 4
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Red/Blue'
}
üîß Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Red/Blue',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  ‚Ä¢ Back: Rubber (...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 600,
  previousLogos: 4,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
üìù [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  ‚Ä¢ Back: Rubber (...
üî¢ [QTY-FIX] Using quantity from context: 600
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'color' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Red/Blue',
  mergedColor: 'Black/White',
  finalColors: [ 'Red', 'Blue' ],
  finalColor: 'Red/Blue'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: Red/Blue Final colors: [ 'Red', 'Blue' ]
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
üéØ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
üé® [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Red', 'Blue' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Red/Blue',
  colors: [ 'Red', 'Blue' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: false,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Red/Blue',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 8648
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change color to red/blue"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Red/Blue\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  ‚Ä¢ Back: Rubber (Medium)\n' +
      '  ‚Ä¢ Front: Leather (Large)\n' +
      '  ‚Ä¢ Left: 3D Embroidery (Small)\n' +
      '  ‚Ä¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $8648.00\n' +
      '\n' +
      'Detected changes:\n' +
      '‚Ä¢ Change color from Black/White to Red/Blue (High confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 600
üí∞ [BLANK-CAP] Panel count requirement: 6P
üí∞ [BLANK-CAP] User bill shape input: null
üîÑ [PRICING-SERVICE] Using cached products: 77 items
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 6P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 2
üéØ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
üéØ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
üéØ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
üé® [LOGO] Processing: Rubber Back Medium 
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
üí∞ [LOGO] Using preserved mold charge from context: 80 for Rubber
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
üé® [LOGO] Processing: Leather Front Large 
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
üí∞ [LOGO] Using preserved mold charge from context: 120 for Leather
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 20ms
‚úÖ [PRICING-SERVICE] Loaded 7 premium closures from Supabase
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $3.75 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $3.63 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.55 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.45 for 2880 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $4 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $3.75 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.63 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.5 for 2880 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $4.25 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $4 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.68 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.6 for 2880 units
‚úÖ [PRICING-SERVICE] Cache pre-warming completed
 ‚úì Compiled in 22ms
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
 ‚úì Compiled /api/support-ai in 197ms (107 modules)
üöÄ [PRICING-SERVICE] Ultra-fast pricing service initialized with intelligent caching
‚úÖ Supabase Admin: Using service role key for elevated permissions
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üîç [ANALYZE] Conversation history length: 0
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üí¨ History messages: 0
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 0 messages
üìã [EXTRACT] No structured quote found, using user specifications only
üìã [EXTRACT] Final extracted specifications: { quantity: 0 }
üìã Previous specifications: { quantity: 0 }
üîç [DETECT] Analyzing message for changes: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
üìã [DETECT] Previous specs for comparison: { quantity: 0 }
üî¢ [DETECT] Quantity change detected: 0 -> 144
üî¢ [DETECT] Quantity change detected: 0 -> 144
üîç [DETECT] Total changes detected: 2
üîç Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
üîß [MERGE] Starting with previous specs: { quantity: 0 }
üîß [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
üîß [MERGE] Preserved critical values: { quantity: null, colors: undefined, logos: 0, accessories: 0 }
üîß [MERGE] Applied quantity change: 144
üîß [MERGE] Preserving existing logos: 0
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] Applied quantity change: 144
üîß [MERGE] Preserving existing logos: 0
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 144,
  logos: 0,
  accessories: 0,
  fabric: undefined,
  colors: undefined
}
üîß Merged specifications: { quantity: 144 }
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mol...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: false,
  hasContext: false,
  changesDetected: 2,
  previousQuantity: 0,
  previousLogos: 0,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: false, detectedChanges: 2, mergedSpecs: 1 }
üìù [ENHANCED-CONTEXT] Using contextual message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charg...
üî¢ [QTY-FIX] Using quantity from context: 144
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: false,
  isConversationalUpdate: false,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'quantity', 'quantity' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: false,
  mergedColors: undefined,
  mergedColor: undefined,
  finalColors: [ 'Black' ],
  finalColor: 'Black'
}
üé® [FORMAT8-COLORS] === START EXTRACTING COLOR ===
üé® [FORMAT8-COLORS] Input text: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
üé® [FORMAT8-COLORS] Slash pattern match: [
  'black/white',
  'black',
  'white',
  index: 80,
  input: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.',
  groups: undefined
]
üé® [FORMAT8-COLORS] Split color parts: { part1: 'black', part2: 'white' }
üé® [FORMAT8-COLORS] Color validation: { part1Valid: true, part2Valid: true }
üé® [FORMAT8-COLORS] RESULT: Split color detected: Black/White
üé® [ENHANCED-ANALYZE] Legacy color detection applied: {
  detectedColor: 'Black/White',
  colors: [ 'Black', 'White' ],
  color: 'Black/White'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: undefined Final colors: [ 'Black', 'White' ]
üìè [ADVANCED-SIZE] Standard size detected: { desc: 'medium', hatSize: '7 1/4' }
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: 7 1/4
üö´ [FABRIC-DETECTION] Skipping color pattern: black/white
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: undefined Final fabric: Polyester
üéØ [PANEL-DETECTION] 7-PANEL DETECTED from message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 7P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: null
üîç [UNIFIED-LOGO] Starting unified detection: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
üîç [UNIFIED-LOGO] Searching for ALL logo patterns in text...
üéØ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "rubber patch" -> Rubber Patch
üìç [UNIFIED-LOGO] Position detected near "rubber patch" at index 102: Back
üìè [UNIFIED-LOGO] Size detected near "rubber patch" at index 102: Medium
‚úÖ [UNIFIED-LOGO] Added: Rubber Patch at Back (Medium) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "leather patch" -> Leather Patch
üìç [UNIFIED-LOGO] Position detected near "leather patch" at index 155: Front
üìè [UNIFIED-LOGO] Size detected near "leather patch" at index 155: Large
‚úÖ [UNIFIED-LOGO] Added: Leather Patch at Front (Large) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "3d embroidery" -> 3D Embroidery
üìç [UNIFIED-LOGO] Position detected near "3d embroidery" at index 213: Left
üìè [UNIFIED-LOGO] Size detected near "3d embroidery" at index 213: Small
‚úÖ [UNIFIED-LOGO] Added: 3D Embroidery at Left (Small) - Confidence: 0.95
üìç [UNIFIED-LOGO] Position detected near "3d embroidery" at index 245: Right
üìè [UNIFIED-LOGO] Size detected near "3d embroidery" at index 245: Small
‚úÖ [UNIFIED-LOGO] Added: 3D Embroidery at Right (Small) - Confidence: 0.95
üéØ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "embroidery" -> Embroidery
üìç [UNIFIED-LOGO] Position detected near "embroidery" at index 216: Left
‚ö†Ô∏è [UNIFIED-LOGO] Position Left already has logo - skipping duplicate
üìç [UNIFIED-LOGO] Position detected near "embroidery" at index 248: Right
‚ö†Ô∏è [UNIFIED-LOGO] Position Right already has logo - skipping duplicate
üéØ [UNIFIED-LOGO] Final results: {
  totalCount: 4,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ],
  summary: 'Back: Rubber Patch (Medium), Front: Leather Patch (Large), Left: 3D Embroidery (Small), Right: 3D Embroidery (Small)'
}
üé® [LEGACY-ANALYZE] UNIFIED logo detection for new request: {
  totalCount: 4,
  hasLogos: true,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ]
}
üè∑Ô∏è [ACCESSORY-DETECTION] Accessories detected: {
  originalText: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  foundAccessories: []
}
üè∑Ô∏è [LEGACY-ANALYZE] Advanced accessories detection for new request: {
  message: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  detectedAccessories: [],
  uniqueCount: 0
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 144,
    fabric: 'Polyester',
    closure: null,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 144,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: '7 1/4',
  fabric: 'Polyester',
  panelCount: '7P',
  closure: null,
  capSpecifications: { panelCount: '7P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber Patch',
    location: 'Back',
    size: 'Medium',
    hasMoldCharge: true,
    priority: 2
  },
  allLogoRequirements: [
    {
      type: 'Rubber Patch',
      location: 'Back',
      size: 'Medium',
      hasMoldCharge: true,
      priority: 2
    },
    {
      type: 'Leather Patch',
      location: 'Front',
      size: 'Large',
      hasMoldCharge: true,
      priority: 1
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: false,
    isConversationalUpdate: false,
    isQuantityUpdate: false,
    detectedChanges: [ [Object], [Object] ],
    mergedSpecifications: { quantity: 144 },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: false,
    closurePreserved: false,
    logosPreserved: false,
    accessoriesPreserved: false
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 144
üí∞ [BLANK-CAP] Panel count requirement: 7P
üí∞ [BLANK-CAP] User bill shape input: null
üîß [PRICING-SERVICE] Loading products from Supabase...
üîß [PRICING-SERVICE] Initializing Supabase client: {
  url: 'https://tfiemrpfsvxv...',
  hasServiceKey: true,
  hasAnonKey: true,
  usingKey: 'SERVICE_ROLE'
}
‚úÖ [PRICING-SERVICE] Supabase client initialized successfully
‚úÖ [PRICING-SERVICE] Supabase client obtained
üîç [PRICING-SERVICE] Query executed, checking results...
üìä [PRICING-SERVICE] Raw query result: 77 products
üìã [PRICING-SERVICE] Sample product: {
  name: '4P Visor Cap MSCS',
  code: '4P_VISOR_CAP_MSCS',
  has_pricing_tier: true,
  tier_name: 'Tier 1'
}
‚úÖ [PRICING-SERVICE] Successfully loaded 77 products from Supabase
‚úÖ [PRICING-SERVICE] Loaded 3 pricing tiers from Supabase
üîÑ [BLANK-CAP] Conversation context check: {
  hasContext: false,
  existingProduct: undefined,
  isConversationalUpdate: false
}
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 7P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 7-Panel detected -> Tier 3 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 3
üéØ [PRODUCT-SELECT] Found 13 products in Tier 3 : [
  '7P CrownFrame 7 LFF',
  '7P CrownFrame 7 LFS',
  '7P CrownFrame 7 MSCF',
  '7P CrownFrame 7 MSCS',
  '7P Elite Seven HFS',
  '7P Elite Seven HSCF',
  '7P Elite Seven HSCS',
  '7P Elite Seven LSCS',
  '7P Elite Seven MFS',
  '7P FlatFrame 7 HSCS',
  '7P Summit Seven HFF',
  '7P Summit Seven LSCF',
  '7P Summit Seven MFF'
]
üéØ [PRODUCT-SELECT] Selected Elite Seven product: 7P Elite Seven HFS
üéØ [BLANK-CAP] Final product selection: {
  name: '7P Elite Seven HFS',
  code: '7P_ELITE_SEVEN_HFS',
  databaseTier: 'Tier 3',
  businessTier: 'Tier 3',
  panelCount: 7,
  databaseBillShape: 'Flat',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '7P Elite Seven HFS',
  tier: 'Tier 3',
  unitPrice: 4.25,
  totalCost: 612,
  quantity: 144
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '7P Elite Seven HFS',
  productCode: '7P_ELITE_SEVEN_HFS',
  panelCount: '7P',
  billShape: 'Flat',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 4.25,
  totalCost: 612,
  pricingTier: 'Tier 3',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Flat',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
‚úÖ [PRICING-SERVICE] Loaded 19 premium fabrics from Supabase
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber Patch @ Back',
  'Leather Patch @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
‚úÖ [PRICING-SERVICE] Loaded 33 logo methods from Supabase
üé® [LOGO] Processing: Rubber Patch Back Medium (+Mold Charge)
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber Patch" (Medium)
üî• [PRICING-SERVICE] Pre-warming cache with common data...
üîÑ [PRICING-SERVICE] Using cached products: 77 items
‚úÖ [PRICING-SERVICE] Loaded 3 mold charges from Supabase
üí∞ [LOGO] Using database mold charge: Medium = 80 for Rubber Patch
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 80,
  totalWithMold: 494.71999999999997
}
üé® [LOGO] Processing: Leather Patch Front Large (+Mold Charge)
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather Patch" (Large)
üí∞ [LOGO] Using database mold charge: Large = 120 for Leather Patch
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 120,
  totalWithMold: 534.72
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 80,
      totalWithMold: 494.71999999999997
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 120,
      totalWithMold: 534.72
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    }
  ],
  totalCost: 1461.44,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
‚úÖ [PRICING-SERVICE] Loaded 6 accessories from Supabase
‚úÖ [PRICING-SERVICE] Loaded 7 premium closures from Supabase
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $3.75 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $3.63 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.55 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.45 for 2880 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $4 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $3.75 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.63 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.5 for 2880 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_144: $4.25 for 288 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_576: $4 for 576 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_1152: $3.68 for 1152 units
üîç [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
üí∞ [PRICING-SERVICE] Selected tier price_2880: $3.6 for 2880 units
‚úÖ [PRICING-SERVICE] Cache pre-warming completed
‚úÖ [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 3.29,
  totalCost: 473.76
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 2547.2, completedSections: 3 }
 POST /api/support-ai 200 in 2789ms
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: change quantity to 600 pieces
üîç [ANALYZE] Conversation history length: 2
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: change quantity to 600 pieces
üí¨ History messages: 2
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 2 messages
üîç [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
üîç [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ..."
üìã [EXTRACT] Found structured quote in message 1
üî¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
üî¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
üî¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢(7P\s+Elite\s+Seven\s+HFS\s*\(Tier\s+3\)) match: ‚Ä¢7P Elite Seven HFS (Tier 3)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*(?:Tier\s+\d)?) match: ‚Ä¢7P Elite Seven HFS (Tier 3)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*) match: ‚Ä¢7P Elite Seven HFS (Tier 3)
üßµ [EXTRACT] Fabrics from quote: Polyester
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-‚Äì]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
üé® [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
üé® [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method:"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber: ‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber: $80
‚úÖ [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
üé® [EXTRACT] Processing conversation logo info: "Leather (Large)"
üé® [EXTRACT] Fallback extraction: type="Leather", size="Large"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 "
üí∞ [MOLD-CHARGE] Analyzing match text for Leather: ‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather: $120
‚úÖ [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Left: 3D Embroidery (Small) - $216.00"
üîç [EXTRACT] Full content context (500 chars): "ase cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 ($3.29/cap)

üí∞ **Total Investment: $2547.20**
**Per Cap Cost"
üí∞ [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Right: 3D Embroidery (Small) - $216.00"
üîç [EXTRACT] Full content context (500 chars): "‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 ($3.29/cap)

üí∞ **Total Investment: $2547.20**
**Per Cap Cost: $17.69**

üìä **Cost Breakdown Per Cap:**
‚Ä¢ Base C"
üí∞ [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-‚Äì]\s*(.+?)(?=\n|$)" found 4 matches
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method:"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber (Medium): ‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($494.72 ($2.88/cap + $80.00 mold))
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢7P Elite Seven HFS (Tier 3)
‚Ä¢Base cost: $612.00 ($4.25/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
‚Ä¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $473.76 "
üí∞ [MOLD-CHARGE] Analyzing match text for Leather (Large): ‚Ä¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather (Large): $120
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($534.72 ($2.88/cap + $120.00 mold))
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üé® [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "Accessories[^‚Ä¢\n]*\n[\s\S]*?‚Ä¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
üîç [EXTRACT] Accessory pattern "(?:üè∑Ô∏è.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nüöö|\nÔøΩ..." found 0 matches
üîç [EXTRACT] Found 0 accessory mentions in structured quote
üé® [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
üé® [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
üé® [EXTRACT] Testing color pattern "‚Ä¢Color:\s*([^\n]+)...": 1 matches
üé® [EXTRACT] Raw extracted color: Black/White
üé® [EXTRACT] ‚úÖ VALID color from structured quote: Black/White
üé® [EXTRACT] Color found, stopping pattern search
üé® [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
üé® [EXTRACT] Final extracted colors: Black/White
üìä [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
üìä [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
üìä [EXTRACT] Calculated quantity: 612 √∑ 4.25 = 144
üìä [EXTRACT] ‚úÖ VALID quantity from structured quote: 144
üìä [EXTRACT] Quantity found, stopping pattern search
üìä [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
üìä [EXTRACT] Final extracted quantity: 144
üöö [EXTRACT] Delivery from quote: Regular Delivery
üí∞ [EXTRACT] Total cost from quote: 2547.2
üîÑ [EXTRACT] Merging structured quote with user specifications
üîÑ [EXTRACT] Latest complete specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üîÑ [EXTRACT] User-specified changes: { quantity: 0 }
üîÑ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 144
üìã [EXTRACT] Final merged specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üìã Previous specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üîç [DETECT] Analyzing message for changes: change quantity to 600 pieces
üìã [DETECT] Previous specs for comparison: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üî¢ [DETECT] Quantity change detected: 144 -> 600
üîç [DETECT] Total changes detected: 1
üîç Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
üîß [MERGE] Starting with previous specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üîß [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
üîß [MERGE] Preserved critical values: { quantity: 144, colors: 'Black/White', logos: 4, accessories: 0 }
üîß [MERGE] Applied quantity change: 600
üîß [MERGE] Preserving existing logos: 4
üîß [MERGE] Preserving existing accessories: 0
üîß [MERGE] ULTRA-CRITICAL: Single aspect change detected (quantity) - ENFORCING preservation
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved colors (Black/White)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (2547.2)
üîß [MERGE] SINGLE-ASPECT CHANGE (quantity:quantity) - Ensuring complete preservation
üîß [MERGE] Force-preserved accessories for single-aspect change: []
üîß [MERGE] Final logos preserved: Back:Rubber(Medium), Front:Leather(Large), Left:3D Embroidery(Small), Right:3D Embroidery(Small)
üîß [MERGE] Final accessories preserved: none
üîß [MERGE] Final fabric preserved: Polyester
üîß [MERGE] Final colors preserved: Black/White
üö® [MERGE] QUANTITY-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üö® [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
üö® [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
üö® [MERGE] FORCE-PRESERVED accessories: []
üö® [MERGE] FORCE-PRESERVED colors: Black/White
üö® [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
üö® [MERGE] FORCE-PRESERVED totalCost: 2547.2
üö® [MERGE] FORCE-PRESERVED colors for quantity change: Black/White
üö® [MERGE] FORCE-PRESERVED logos: 4
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Black/White'
}
üîß Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  ‚Ä¢ Back: ...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 144,
  previousLogos: 4,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
üìù [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  ‚Ä¢ Back: ...
üî¢ [QTY-FIX] Using quantity from context: 600
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: true,
  detectedChangeTypes: [ 'quantity' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Black/White',
  mergedColor: 'Black/White',
  finalColors: [ 'Black', 'White' ],
  finalColor: 'Black/White'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: Black/White Final colors: [ 'Black', 'White' ]
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
üéØ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
üé® [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: true,
  preservedContext: {
    fabric: 'PRESERVED',
    closure: 'PRESERVED',
    logos: 'PRESERVED (4)',
    accessories: 'PRESERVED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: true,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Black/White',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 2547.2
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change quantity to 600 pieces"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Black/White\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  ‚Ä¢ Back: Rubber (Medium)\n' +
      '  ‚Ä¢ Front: Leather (Large)\n' +
      '  ‚Ä¢ Left: 3D Embroidery (Small)\n' +
      '  ‚Ä¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $2547.20\n' +
      '\n' +
      'Detected changes:\n' +
      '‚Ä¢ Change quantity from 144 to 600 pieces (Medium confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: true,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 600
üí∞ [BLANK-CAP] Panel count requirement: 6P
üí∞ [BLANK-CAP] User bill shape input: null
üîÑ [PRICING-SERVICE] Using cached products: 77 items
üîÑ [BLANK-CAP] Conversation context check: {
  hasContext: true,
  existingProduct: undefined,
  isConversationalUpdate: true
}
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 6P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 2
üéØ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
üéØ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
üéØ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
üé® [LOGO] Processing: Rubber Back Medium 
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
üí∞ [LOGO] Using preserved mold charge from context: 80 for Rubber
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
üé® [LOGO] Processing: Leather Front Large 
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
üí∞ [LOGO] Using preserved mold charge from context: 120 for Leather
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 32ms
üéØ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
üîÑ [FORMAT #8 DIRECT] Using Format #8 functions directly
üîç [ANALYZE] Parsing customer message: change color to red/blue
üîç [ANALYZE] Conversation history length: 4
üß† [CONTEXT-SERVICE] Starting intelligent context analysis
üìù Current message: change color to red/blue
üí¨ History messages: 4
üìã [EXTRACT-SPECS] Starting extraction from conversation history: 4 messages
üîç [EXTRACT-DEBUG] Message 3: role=assistant, content length=1239
üîç [EXTRACT-DEBUG] Assistant message preview: "I've updated your quote with the requested changes:

üîÑ **Changes Applied:**
‚Ä¢ Change quantity from 144 to 600 pieces

üí∞ **Cost Impact:** +$6100.80 increase (from $2547.20 to $8648.00)

Here's your d..."
üìã [EXTRACT] Found structured quote in message 3
üî¢ [EXTRACT] Found valid quantity: 2250 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
üî¢ [EXTRACT] Found valid quantity: 600 using pattern: (\d+,?\d*)\s*pieces?
üî¢ [EXTRACT] FINAL selected quantity: 2250 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 2
üî¢ [EXTRACT] All found quantities: [
  '2250 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)',
  '600 ((\\d+,?\\d*)\\s*pieces?)'
]
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢(6P\s+AirFrame\s+HSCS\s*\(Tier\s+2\)) match: ‚Ä¢6P AirFrame HSCS (Tier 2)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*(?:Tier\s+\d)?) match: ‚Ä¢6P AirFrame HSCS (Tier 2)
‚ö†Ô∏è [EXTRACT] Pattern matched but no capture group: ‚Ä¢([^‚Ä¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^‚Ä¢\n]*) match: ‚Ä¢6P AirFrame HSCS (Tier 2)
üßµ [EXTRACT] Fabrics from quote: Polyester
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-‚Äì]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
üé® [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
üé® [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Metho"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber: ‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber: $80
‚úÖ [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
üé® [EXTRACT] Processing conversation logo info: "Leather (Large)"
üé® [EXTRACT] Fallback extraction: type="Leather", size="Large"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.0"
üí∞ [MOLD-CHARGE] Analyzing match text for Leather: ‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather: $120
‚úÖ [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Left: 3D Embroidery (Small) - $708.00"
üîç [EXTRACT] Full content context (500 chars): " cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.00 ($2.71/cap)

üí∞ **Total Investment: $8648.00**
**Per Cap Cos"
üí∞ [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
üé® [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
üé® [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
üîç [EXTRACT] Match text: "‚Ä¢Right: 3D Embroidery (Small) - $708.00"
üîç [EXTRACT] Full content context (500 chars): "**Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.00 ($2.71/cap)

üí∞ **Total Investment: $8648.00**
**Per Cap Cost: $14.41**

üìä **Cost Breakdown Per Cap:**
‚Ä¢ Base "
üí∞ [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
‚úÖ [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-‚Äì]\s*(.+?)(?=\n|$)" found 4 matches
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
üîç [EXTRACT] Match text: "‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Metho"
üí∞ [MOLD-CHARGE] Analyzing match text for Rubber (Medium): ‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $80
üí∞ [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($1658.00 ($2.63/cap + $80.00 mold))
üîç [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
üîç [EXTRACT] Match text: "‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
üîç [EXTRACT] Full content context (500 chars): "se:

üìä **Cap Style Setup** ‚úÖ
‚Ä¢6P AirFrame HSCS (Tier 2)
‚Ä¢Base cost: $2250.00 ($3.75/cap)
‚Ä¢Color: Black/White

‚≠ê **Premium Upgrades** ‚úÖ
‚Ä¢Polyester: (+$0.00) ($0.00/cap)

üé® **Logo Setup** ‚úÖ
‚Ä¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
‚Ä¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
‚Ä¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

üöö **Delivery** ‚úÖ
‚Ä¢Method: Regular Delivery
‚Ä¢Timeline: 6-10 days days
‚Ä¢Cost: $1626.0"
üí∞ [MOLD-CHARGE] Analyzing match text for Leather (Large): ‚Ä¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
üí∞ [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
üí∞ [MOLD-CHARGE] Using fixed mold charge: $120
üí∞ [EXTRACT] Detected mold charge for Front Leather (Large): $120
üîç [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
‚ö†Ô∏è [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($1698.00 ($2.63/cap + $120.00 mold))
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 0 matches
üîç [EXTRACT] Logo pattern "‚Ä¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-‚Äì]\s*\$[\d,]+\.?\d*" found 4 matches
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üîÑ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
üîÑ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
üé® [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "‚Ä¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
üîç [EXTRACT] Accessory pattern "Accessories[^‚Ä¢\n]*\n[\s\S]*?‚Ä¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
üîç [EXTRACT] Accessory pattern "(?:üè∑Ô∏è.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nüöö|\nÔøΩ..." found 0 matches
üîç [EXTRACT] Found 0 accessory mentions in structured quote
üé® [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
üé® [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
üé® [EXTRACT] Testing color pattern "‚Ä¢Color:\s*([^\n]+)...": 1 matches
üé® [EXTRACT] Raw extracted color: Black/White
üé® [EXTRACT] ‚úÖ VALID color from structured quote: Black/White
üé® [EXTRACT] Color found, stopping pattern search
üé® [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
üé® [EXTRACT] Final extracted colors: Black/White
üìä [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
üìä [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
üìä [EXTRACT] Calculated quantity: 2250 √∑ 3.75 = 600
üìä [EXTRACT] ‚úÖ VALID quantity from structured quote: 600
üìä [EXTRACT] Quantity found, stopping pattern search
üìä [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
üìä [EXTRACT] Final extracted quantity: 600
üöö [EXTRACT] Delivery from quote: Regular Delivery
üí∞ [EXTRACT] Total cost from quote: 8648
üîÑ [EXTRACT] Merging structured quote with user specifications
üîÑ [EXTRACT] Latest complete specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üîÑ [EXTRACT] User-specified changes: { quantity: 0 }
üîÑ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 600
üìã [EXTRACT] Final merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üìã Previous specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üîç [DETECT] Analyzing message for changes: change color to red/blue
üìã [DETECT] Previous specs for comparison: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üé® [CONTEXT-SERVICE] === COLOR CHANGE DETECTION ===
üé® [CONTEXT-SERVICE] Previous color: Black/White
üé® [CONTEXT-SERVICE] New color: Red/Blue
üé® [CONTEXT-SERVICE] Colors different?: true
üé® [CONTEXT-SERVICE] RESULT: Color change detected: Black/White -> Red/Blue
üîç [DETECT] Total changes detected: 1
üîç Detected changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
üîß [MERGE] Starting with previous specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üîß [MERGE] Applying changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
üîß [MERGE] Preserved critical values: { quantity: 600, colors: 'Black/White', logos: 4, accessories: 0 }
üé® [CONTEXT-SERVICE] === MERGING COLOR CHANGE ===
üé® [CONTEXT-SERVICE] Previous colors: Black/White
üé® [CONTEXT-SERVICE] New color value: Red/Blue
üé® [CONTEXT-SERVICE] RESULT: Applied color change: Red/Blue
üé® [CONTEXT-SERVICE] Final merged colors: Red/Blue
üîß [MERGE] ULTRA-CRITICAL: Single aspect change detected (colors) - ENFORCING preservation
üîß [MERGE] ULTRA-CRITICAL: Force-preserved quantity (600)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
üîß [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (8648)
üö® [MERGE] COLOR-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
üö® [MERGE] FORCE-PRESERVED quantity: 600
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üö® [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
üö® [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
üö® [MERGE] FORCE-PRESERVED accessories: []
üö® [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
üö® [MERGE] FORCE-PRESERVED totalCost: 8648
üö® [MERGE] FORCE-PRESERVED quantity for color change: 600
üö® [MERGE] FORCE-PRESERVED logos: 4
üö® [MERGE] FORCE-PRESERVED fabric: Polyester
üîß [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Red/Blue'
}
üîß Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Red/Blue',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
üìù [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  ‚Ä¢ Back: Rubber (...
üß† [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 600,
  previousLogos: 4,
  previousAccessories: 0
}
üß† [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
üìù [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  ‚Ä¢ Back: Rubber (...
üî¢ [QTY-FIX] Using quantity from context: 600
üîÑ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'color' ]
}
üé® [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Red/Blue',
  mergedColor: 'Black/White',
  finalColors: [ 'Red', 'Blue' ],
  finalColor: 'Red/Blue'
}
üé® [ENHANCED-ANALYZE] Colors - Merged specs: Red/Blue Final colors: [ 'Red', 'Blue' ]
üìè [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
üßµ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
üéØ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
üéØ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
üéØ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
üîí [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
üé® [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
‚úÖ [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Red', 'Blue' ]
  }
}
üìã [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Red/Blue',
  colors: [ 'Red', 'Blue' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: false,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Red/Blue',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 8648
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change color to red/blue"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Red/Blue\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  ‚Ä¢ Back: Rubber (Medium)\n' +
      '  ‚Ä¢ Front: Leather (Large)\n' +
      '  ‚Ä¢ Left: 3D Embroidery (Small)\n' +
      '  ‚Ä¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $8648.00\n' +
      '\n' +
      'Detected changes:\n' +
      '‚Ä¢ Change color from Black/White to Red/Blue (High confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
üí∞ [BLANK-CAP] Fetching costs for quantity: 600
üí∞ [BLANK-CAP] Panel count requirement: 6P
üí∞ [BLANK-CAP] User bill shape input: null
üîÑ [PRICING-SERVICE] Using cached products: 77 items
üîÑ [BLANK-CAP] Conversation context check: {
  hasContext: true,
  existingProduct: undefined,
  isConversationalUpdate: true
}
üéØ [PRICING-TIER] Determining tier based on business logic
üéØ [PRICING-TIER] Panel count: 6P
üéØ [PRICING-TIER] Bill style: null
üéØ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
üéØ [PRODUCT-SELECT] Looking for products in Tier 2
üéØ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
üéØ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
üéØ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
üí∞ [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
‚úÖ [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
‚≠ê [PREMIUM] Fetching premium upgrades
üßµ [PREMIUM] Processing fabric requirement: Polyester
üßµ [PREMIUM] Processing fabric types: [ 'Polyester' ]
üîç [PREMIUM] Looking for fabric: Polyester -> Polyester
‚úÖ [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
‚úÖ [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
‚≠ê [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
‚úÖ [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
üé® [LOGO] Fetching logo setup costs
üé® [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
üé® [LOGO] Processing: Rubber Back Medium 
‚úÖ [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
üí∞ [LOGO] Using preserved mold charge from context: 80 for Rubber
‚úÖ [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
üé® [LOGO] Processing: Leather Front Large 
‚úÖ [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
üí∞ [LOGO] Using preserved mold charge from context: 120 for Leather
‚úÖ [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
üé® [LOGO] Processing: 3D Embroidery Left Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
üé® [LOGO] Processing: 3D Embroidery Right Small 
‚úÖ [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
‚úÖ [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
‚úÖ [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
üè∑Ô∏è [ACCESSORIES] Fetching accessories costs
üè∑Ô∏è [ACCESSORIES] No accessories requirements found
‚úÖ [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
üöö [DELIVERY] Fetching delivery costs
‚úÖ [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
‚úÖ [FORMAT #8 DIRECT] Format #8 response generated
üîÑ [TRANSFORM] Converting Format #8 to Order Builder structure
‚úÖ [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 23ms
 ‚óã Compiling /_not-found ...
 ‚úì Compiled /_not-found in 4.6s (1652 modules)
üèóÔ∏è AuthProvider: Rendering - isHydrated: false loading: true
 POST /api/support-ai 404 in 5690ms
 ‚úì Compiled in 1088ms (781 modules)
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
 ‚úì Compiled in 32ms
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
üßπ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
