
> customcap@0.1.0 dev
> next dev

 âš  Port 3000 is in use by process 31900, using available port 3003 instead.
   â–² Next.js 15.4.6
   - Local:        http://localhost:3003
   - Network:      http://10.5.0.2:3003
   - Environments: .env.local, .env

 âœ“ Starting...
 âœ“ Ready in 2.3s
 â—‹ Compiling /api/support-ai ...
 âœ“ Compiled /api/support-ai in 1511ms (292 modules)
ğŸš€ [PRICING-SERVICE] Ultra-fast pricing service initialized with intelligent caching
âœ… Supabase Admin: Using service role key for elevated permissions
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ” [ANALYZE] Conversation history length: 0
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ’¬ History messages: 0
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 0 messages
ğŸ“‹ [EXTRACT] No structured quote found, using user specifications only
ğŸ“‹ [EXTRACT] Final extracted specifications: { quantity: 0 }
ğŸ“‹ Previous specifications: { quantity: 0 }
ğŸ” [DETECT] Analyzing message for changes: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
ğŸ“‹ [DETECT] Previous specs for comparison: { quantity: 0 }
ğŸ”¢ [DETECT] Quantity change detected: 0 -> 144
ğŸ”¢ [DETECT] Quantity change detected: 0 -> 144
ğŸ” [DETECT] Total changes detected: 2
ğŸ” Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: { quantity: 0 }
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: null, colors: undefined, logos: 0, accessories: 0 }
ğŸ”§ [MERGE] Applied quantity change: 144
ğŸ”§ [MERGE] Preserving existing logos: 0
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] Applied quantity change: 144
ğŸ”§ [MERGE] Preserving existing logos: 0
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 144,
  logos: 0,
  accessories: 0,
  fabric: undefined,
  colors: undefined
}
ğŸ”§ Merged specifications: { quantity: 144 }
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mol...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: false,
  hasContext: false,
  changesDetected: 2,
  previousQuantity: 0,
  previousLogos: 0,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: false, detectedChanges: 2, mergedSpecs: 1 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charg...
ğŸ”¢ [QTY-FIX] Using quantity from context: 144
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: false,
  isConversationalUpdate: false,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'quantity', 'quantity' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: false,
  mergedColors: undefined,
  mergedColor: undefined,
  finalColors: [ 'Black' ],
  finalColor: 'Black'
}
ğŸ¨ [FORMAT8-COLORS] === START EXTRACTING COLOR ===
ğŸ¨ [FORMAT8-COLORS] Input text: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
ğŸ¨ [FORMAT8-COLORS] Slash pattern match: [
  'black/white',
  'black',
  'white',
  index: 80,
  input: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.',
  groups: undefined
]
ğŸ¨ [FORMAT8-COLORS] Split color parts: { part1: 'black', part2: 'white' }
ğŸ¨ [FORMAT8-COLORS] Color validation: { part1Valid: true, part2Valid: true }
ğŸ¨ [FORMAT8-COLORS] RESULT: Split color detected: Black/White
ğŸ¨ [ENHANCED-ANALYZE] Legacy color detection applied: {
  detectedColor: 'Black/White',
  colors: [ 'Black', 'White' ],
  color: 'Black/White'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: undefined Final colors: [ 'Black', 'White' ]
ğŸ“ [ADVANCED-SIZE] Standard size detected: { desc: 'medium', hatSize: '7 1/4' }
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: 7 1/4
ğŸš« [FABRIC-DETECTION] Skipping color pattern: black/white
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: undefined Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] 7-PANEL DETECTED from message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 7P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: null
ğŸ” [UNIFIED-LOGO] Starting unified detection: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ” [UNIFIED-LOGO] Searching for ALL logo patterns in text...
ğŸ¯ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "rubber patch" -> Rubber Patch
ğŸ“ [UNIFIED-LOGO] Position detected near "rubber patch" at index 102: Back
ğŸ“ [UNIFIED-LOGO] Size detected near "rubber patch" at index 102: Medium
âœ… [UNIFIED-LOGO] Added: Rubber Patch at Back (Medium) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "leather patch" -> Leather Patch
ğŸ“ [UNIFIED-LOGO] Position detected near "leather patch" at index 155: Front
ğŸ“ [UNIFIED-LOGO] Size detected near "leather patch" at index 155: Large
âœ… [UNIFIED-LOGO] Added: Leather Patch at Front (Large) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "3d embroidery" -> 3D Embroidery
ğŸ“ [UNIFIED-LOGO] Position detected near "3d embroidery" at index 213: Left
ğŸ“ [UNIFIED-LOGO] Size detected near "3d embroidery" at index 213: Small
âœ… [UNIFIED-LOGO] Added: 3D Embroidery at Left (Small) - Confidence: 0.95
ğŸ“ [UNIFIED-LOGO] Position detected near "3d embroidery" at index 245: Right
ğŸ“ [UNIFIED-LOGO] Size detected near "3d embroidery" at index 245: Small
âœ… [UNIFIED-LOGO] Added: 3D Embroidery at Right (Small) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "embroidery" -> Embroidery
ğŸ“ [UNIFIED-LOGO] Position detected near "embroidery" at index 216: Left
âš ï¸ [UNIFIED-LOGO] Position Left already has logo - skipping duplicate
ğŸ“ [UNIFIED-LOGO] Position detected near "embroidery" at index 248: Right
âš ï¸ [UNIFIED-LOGO] Position Right already has logo - skipping duplicate
ğŸ¯ [UNIFIED-LOGO] Final results: {
  totalCount: 4,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ],
  summary: 'Back: Rubber Patch (Medium), Front: Leather Patch (Large), Left: 3D Embroidery (Small), Right: 3D Embroidery (Small)'
}
ğŸ¨ [LEGACY-ANALYZE] UNIFIED logo detection for new request: {
  totalCount: 4,
  hasLogos: true,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ]
}
ğŸ·ï¸ [ACCESSORY-DETECTION] Accessories detected: {
  originalText: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  foundAccessories: []
}
ğŸ·ï¸ [LEGACY-ANALYZE] Advanced accessories detection for new request: {
  message: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  detectedAccessories: [],
  uniqueCount: 0
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 144,
    fabric: 'Polyester',
    closure: null,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 144,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: '7 1/4',
  fabric: 'Polyester',
  panelCount: '7P',
  closure: null,
  capSpecifications: { panelCount: '7P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber Patch',
    location: 'Back',
    size: 'Medium',
    hasMoldCharge: true,
    priority: 2
  },
  allLogoRequirements: [
    {
      type: 'Rubber Patch',
      location: 'Back',
      size: 'Medium',
      hasMoldCharge: true,
      priority: 2
    },
    {
      type: 'Leather Patch',
      location: 'Front',
      size: 'Large',
      hasMoldCharge: true,
      priority: 1
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: false,
    isConversationalUpdate: false,
    isQuantityUpdate: false,
    detectedChanges: [ [Object], [Object] ],
    mergedSpecifications: { quantity: 144 },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: false,
    closurePreserved: false,
    logosPreserved: false,
    accessoriesPreserved: false
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 144
ğŸ’° [BLANK-CAP] Panel count requirement: 7P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”§ [PRICING-SERVICE] Loading products from Supabase...
ğŸ”§ [PRICING-SERVICE] Initializing Supabase client: {
  url: 'https://tfiemrpfsvxv...',
  hasServiceKey: true,
  hasAnonKey: true,
  usingKey: 'SERVICE_ROLE'
}
âœ… [PRICING-SERVICE] Supabase client initialized successfully
âœ… [PRICING-SERVICE] Supabase client obtained
ğŸ” [PRICING-SERVICE] Query executed, checking results...
ğŸ“Š [PRICING-SERVICE] Raw query result: 77 products
ğŸ“‹ [PRICING-SERVICE] Sample product: {
  name: '4P Visor Cap MSCS',
  code: '4P_VISOR_CAP_MSCS',
  has_pricing_tier: true,
  tier_name: 'Tier 1'
}
âœ… [PRICING-SERVICE] Successfully loaded 77 products from Supabase
âœ… [PRICING-SERVICE] Loaded 3 pricing tiers from Supabase
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 7P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 7-Panel detected -> Tier 3 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 3
ğŸ¯ [PRODUCT-SELECT] Found 13 products in Tier 3 : [
  '7P CrownFrame 7 LFF',
  '7P CrownFrame 7 LFS',
  '7P CrownFrame 7 MSCF',
  '7P CrownFrame 7 MSCS',
  '7P Elite Seven HFS',
  '7P Elite Seven HSCF',
  '7P Elite Seven HSCS',
  '7P Elite Seven LSCS',
  '7P Elite Seven MFS',
  '7P FlatFrame 7 HSCS',
  '7P Summit Seven HFF',
  '7P Summit Seven LSCF',
  '7P Summit Seven MFF'
]
ğŸ¯ [PRODUCT-SELECT] Selected Elite Seven product: 7P Elite Seven HFS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '7P Elite Seven HFS',
  code: '7P_ELITE_SEVEN_HFS',
  databaseTier: 'Tier 3',
  businessTier: 'Tier 3',
  panelCount: 7,
  databaseBillShape: 'Flat',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '7P Elite Seven HFS',
  tier: 'Tier 3',
  unitPrice: 4.25,
  totalCost: 612,
  quantity: 144
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '7P Elite Seven HFS',
  productCode: '7P_ELITE_SEVEN_HFS',
  panelCount: '7P',
  billShape: 'Flat',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 4.25,
  totalCost: 612,
  pricingTier: 'Tier 3',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Flat',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
âœ… [PRICING-SERVICE] Loaded 19 premium fabrics from Supabase
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber Patch @ Back',
  'Leather Patch @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
âœ… [PRICING-SERVICE] Loaded 33 logo methods from Supabase
ğŸ¨ [LOGO] Processing: Rubber Patch Back Medium (+Mold Charge)
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber Patch" (Medium)
ğŸ”¥ [PRICING-SERVICE] Pre-warming cache with common data...
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
âœ… [PRICING-SERVICE] Loaded 3 mold charges from Supabase
ğŸ’° [LOGO] Using database mold charge: Medium = 80 for Rubber Patch
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 80,
  totalWithMold: 494.71999999999997
}
ğŸ¨ [LOGO] Processing: Leather Patch Front Large (+Mold Charge)
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather Patch" (Large)
ğŸ’° [LOGO] Using database mold charge: Large = 120 for Leather Patch
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 120,
  totalWithMold: 534.72
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 80,
      totalWithMold: 494.71999999999997
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 120,
      totalWithMold: 534.72
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    }
  ],
  totalCost: 1461.44,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
âœ… [PRICING-SERVICE] Loaded 6 accessories from Supabase
âœ… [PRICING-SERVICE] Loaded 7 premium closures from Supabase
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $3.75 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $3.63 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.55 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.45 for 2880 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $4 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $3.75 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.63 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.5 for 2880 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $4.25 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $4 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.68 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.6 for 2880 units
âœ… [PRICING-SERVICE] Cache pre-warming completed
âœ… [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 3.29,
  totalCost: 473.76
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 2547.2, completedSections: 3 }
 POST /api/support-ai 200 in 4317ms
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: change quantity to 600 pieces
ğŸ” [ANALYZE] Conversation history length: 2
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: change quantity to 600 pieces
ğŸ’¬ History messages: 2
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 2 messages
ğŸ” [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…..."
ğŸ“‹ [EXTRACT] Found structured quote in message 1
ğŸ”¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
ğŸ”¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
ğŸ”¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
âŒ [SUPPORT AI - FORMAT #8] Processing failed: TypeError: Cannot read properties of undefined (reading 'trim')
    at ConversationContextService.extractSpecificationsFromQuote (src\lib\support-ai\conversation-context.ts:344:44)
    at ConversationContextService.extractPreviousSpecifications (src\lib\support-ai\conversation-context.ts:213:21)
    at ConversationContextService.buildSmartContextualRequest (src\lib\support-ai\conversation-context.ts:107:37)
    at analyzeCustomerRequirements (src\lib\pricing\format8-functions.ts:678:57)
    at async POST (src\app\api\support-ai\route.ts:56:25)
  342 |       const productMatch = content.match(pattern);
  343 |       if (productMatch) {
> 344 |         specs.productName = productMatch[1].trim();
      |                                            ^
  345 |         console.log('ğŸ¯ [EXTRACT] Product from quote:', specs.productName);
  346 |
  347 |         // Extract panel count from product name for preservation
 POST /api/support-ai 500 in 117ms
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: change color to red/blue
ğŸ” [ANALYZE] Conversation history length: 4
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: change color to red/blue
ğŸ’¬ History messages: 4
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 4 messages
ğŸ” [EXTRACT-DEBUG] Message 3: role=assistant, content length=178
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "I apologize, but I'm having trouble creating your quote right now. Please try rephrasing your request with specific details like quantity, colors, and customization requirements...."
ğŸ” [EXTRACT-DEBUG] Message 2: role=user, content length=29
ğŸ¨ [EXTRACT-USER] === START COLOR EXTRACTION ===
ğŸ¨ [EXTRACT-USER] Input content: change quantity to 600 pieces
ğŸ¨ [EXTRACT-USER] === END COLOR EXTRACTION ===
ğŸ” [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…..."
ğŸ“‹ [EXTRACT] Found structured quote in message 1
ğŸ”¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
ğŸ”¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
ğŸ”¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
âŒ [SUPPORT AI - FORMAT #8] Processing failed: TypeError: Cannot read properties of undefined (reading 'trim')
    at ConversationContextService.extractSpecificationsFromQuote (src\lib\support-ai\conversation-context.ts:344:44)
    at ConversationContextService.extractPreviousSpecifications (src\lib\support-ai\conversation-context.ts:213:21)
    at async ConversationContextService.buildSmartContextualRequest (src\lib\support-ai\conversation-context.ts:107:26)
    at async analyzeCustomerRequirements (src\lib\pricing\format8-functions.ts:678:24)
    at async POST (src\app\api\support-ai\route.ts:56:25)
  342 |       const productMatch = content.match(pattern);
  343 |       if (productMatch) {
> 344 |         specs.productName = productMatch[1].trim();
      |                                            ^
  345 |         console.log('ğŸ¯ [EXTRACT] Product from quote:', specs.productName);
  346 |
  347 |         // Extract panel count from product name for preservation
 POST /api/support-ai 500 in 68ms
 âœ“ Compiled in 288ms (107 modules)
ğŸš€ [PRICING-SERVICE] Ultra-fast pricing service initialized with intelligent caching
âœ… Supabase Admin: Using service role key for elevated permissions
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ” [ANALYZE] Conversation history length: 0
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ’¬ History messages: 0
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 0 messages
ğŸ“‹ [EXTRACT] No structured quote found, using user specifications only
ğŸ“‹ [EXTRACT] Final extracted specifications: { quantity: 0 }
ğŸ“‹ Previous specifications: { quantity: 0 }
ğŸ” [DETECT] Analyzing message for changes: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
ğŸ“‹ [DETECT] Previous specs for comparison: { quantity: 0 }
ğŸ”¢ [DETECT] Quantity change detected: 0 -> 144
ğŸ”¢ [DETECT] Quantity change detected: 0 -> 144
ğŸ” [DETECT] Total changes detected: 2
ğŸ” Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: { quantity: 0 }
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: null, colors: undefined, logos: 0, accessories: 0 }
ğŸ”§ [MERGE] Applied quantity change: 144
ğŸ”§ [MERGE] Preserving existing logos: 0
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] Applied quantity change: 144
ğŸ”§ [MERGE] Preserving existing logos: 0
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 144,
  logos: 0,
  accessories: 0,
  fabric: undefined,
  colors: undefined
}
ğŸ”§ Merged specifications: { quantity: 144 }
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mol...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: false,
  hasContext: false,
  changesDetected: 2,
  previousQuantity: 0,
  previousLogos: 0,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: false, detectedChanges: 2, mergedSpecs: 1 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charg...
ğŸ”¢ [QTY-FIX] Using quantity from context: 144
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: false,
  isConversationalUpdate: false,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'quantity', 'quantity' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: false,
  mergedColors: undefined,
  mergedColor: undefined,
  finalColors: [ 'Black' ],
  finalColor: 'Black'
}
ğŸ¨ [FORMAT8-COLORS] === START EXTRACTING COLOR ===
ğŸ¨ [FORMAT8-COLORS] Input text: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
ğŸ¨ [FORMAT8-COLORS] Slash pattern match: [
  'black/white',
  'black',
  'white',
  index: 80,
  input: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.',
  groups: undefined
]
ğŸ¨ [FORMAT8-COLORS] Split color parts: { part1: 'black', part2: 'white' }
ğŸ¨ [FORMAT8-COLORS] Color validation: { part1Valid: true, part2Valid: true }
ğŸ¨ [FORMAT8-COLORS] RESULT: Split color detected: Black/White
ğŸ¨ [ENHANCED-ANALYZE] Legacy color detection applied: {
  detectedColor: 'Black/White',
  colors: [ 'Black', 'White' ],
  color: 'Black/White'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: undefined Final colors: [ 'Black', 'White' ]
ğŸ“ [ADVANCED-SIZE] Standard size detected: { desc: 'medium', hatSize: '7 1/4' }
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: 7 1/4
ğŸš« [FABRIC-DETECTION] Skipping color pattern: black/white
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: undefined Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] 7-PANEL DETECTED from message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 7P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: null
ğŸ” [UNIFIED-LOGO] Starting unified detection: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ” [UNIFIED-LOGO] Searching for ALL logo patterns in text...
ğŸ¯ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "rubber patch" -> Rubber Patch
ğŸ“ [UNIFIED-LOGO] Position detected near "rubber patch" at index 102: Back
ğŸ“ [UNIFIED-LOGO] Size detected near "rubber patch" at index 102: Medium
âœ… [UNIFIED-LOGO] Added: Rubber Patch at Back (Medium) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "leather patch" -> Leather Patch
ğŸ“ [UNIFIED-LOGO] Position detected near "leather patch" at index 155: Front
ğŸ“ [UNIFIED-LOGO] Size detected near "leather patch" at index 155: Large
âœ… [UNIFIED-LOGO] Added: Leather Patch at Front (Large) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "3d embroidery" -> 3D Embroidery
ğŸ“ [UNIFIED-LOGO] Position detected near "3d embroidery" at index 213: Left
ğŸ“ [UNIFIED-LOGO] Size detected near "3d embroidery" at index 213: Small
âœ… [UNIFIED-LOGO] Added: 3D Embroidery at Left (Small) - Confidence: 0.95
ğŸ“ [UNIFIED-LOGO] Position detected near "3d embroidery" at index 245: Right
ğŸ“ [UNIFIED-LOGO] Size detected near "3d embroidery" at index 245: Small
âœ… [UNIFIED-LOGO] Added: 3D Embroidery at Right (Small) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "embroidery" -> Embroidery
ğŸ“ [UNIFIED-LOGO] Position detected near "embroidery" at index 216: Left
âš ï¸ [UNIFIED-LOGO] Position Left already has logo - skipping duplicate
ğŸ“ [UNIFIED-LOGO] Position detected near "embroidery" at index 248: Right
âš ï¸ [UNIFIED-LOGO] Position Right already has logo - skipping duplicate
ğŸ¯ [UNIFIED-LOGO] Final results: {
  totalCount: 4,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ],
  summary: 'Back: Rubber Patch (Medium), Front: Leather Patch (Large), Left: 3D Embroidery (Small), Right: 3D Embroidery (Small)'
}
ğŸ¨ [LEGACY-ANALYZE] UNIFIED logo detection for new request: {
  totalCount: 4,
  hasLogos: true,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ]
}
ğŸ·ï¸ [ACCESSORY-DETECTION] Accessories detected: {
  originalText: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  foundAccessories: []
}
ğŸ·ï¸ [LEGACY-ANALYZE] Advanced accessories detection for new request: {
  message: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  detectedAccessories: [],
  uniqueCount: 0
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 144,
    fabric: 'Polyester',
    closure: null,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 144,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: '7 1/4',
  fabric: 'Polyester',
  panelCount: '7P',
  closure: null,
  capSpecifications: { panelCount: '7P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber Patch',
    location: 'Back',
    size: 'Medium',
    hasMoldCharge: true,
    priority: 2
  },
  allLogoRequirements: [
    {
      type: 'Rubber Patch',
      location: 'Back',
      size: 'Medium',
      hasMoldCharge: true,
      priority: 2
    },
    {
      type: 'Leather Patch',
      location: 'Front',
      size: 'Large',
      hasMoldCharge: true,
      priority: 1
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: false,
    isConversationalUpdate: false,
    isQuantityUpdate: false,
    detectedChanges: [ [Object], [Object] ],
    mergedSpecifications: { quantity: 144 },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $50 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: false,
    closurePreserved: false,
    logosPreserved: false,
    accessoriesPreserved: false
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 144
ğŸ’° [BLANK-CAP] Panel count requirement: 7P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”§ [PRICING-SERVICE] Loading products from Supabase...
ğŸ”§ [PRICING-SERVICE] Initializing Supabase client: {
  url: 'https://tfiemrpfsvxv...',
  hasServiceKey: true,
  hasAnonKey: true,
  usingKey: 'SERVICE_ROLE'
}
âœ… [PRICING-SERVICE] Supabase client initialized successfully
âœ… [PRICING-SERVICE] Supabase client obtained
ğŸ” [PRICING-SERVICE] Query executed, checking results...
ğŸ“Š [PRICING-SERVICE] Raw query result: 77 products
ğŸ“‹ [PRICING-SERVICE] Sample product: {
  name: '4P Visor Cap MSCS',
  code: '4P_VISOR_CAP_MSCS',
  has_pricing_tier: true,
  tier_name: 'Tier 1'
}
âœ… [PRICING-SERVICE] Successfully loaded 77 products from Supabase
âœ… [PRICING-SERVICE] Loaded 3 pricing tiers from Supabase
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 7P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 7-Panel detected -> Tier 3 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 3
ğŸ¯ [PRODUCT-SELECT] Found 13 products in Tier 3 : [
  '7P CrownFrame 7 LFF',
  '7P CrownFrame 7 LFS',
  '7P CrownFrame 7 MSCF',
  '7P CrownFrame 7 MSCS',
  '7P Elite Seven HFS',
  '7P Elite Seven HSCF',
  '7P Elite Seven HSCS',
  '7P Elite Seven LSCS',
  '7P Elite Seven MFS',
  '7P FlatFrame 7 HSCS',
  '7P Summit Seven HFF',
  '7P Summit Seven LSCF',
  '7P Summit Seven MFF'
]
ğŸ¯ [PRODUCT-SELECT] Selected Elite Seven product: 7P Elite Seven HFS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '7P Elite Seven HFS',
  code: '7P_ELITE_SEVEN_HFS',
  databaseTier: 'Tier 3',
  businessTier: 'Tier 3',
  panelCount: 7,
  databaseBillShape: 'Flat',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '7P Elite Seven HFS',
  tier: 'Tier 3',
  unitPrice: 4.25,
  totalCost: 612,
  quantity: 144
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '7P Elite Seven HFS',
  productCode: '7P_ELITE_SEVEN_HFS',
  panelCount: '7P',
  billShape: 'Flat',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 4.25,
  totalCost: 612,
  pricingTier: 'Tier 3',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Flat',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
âœ… [PRICING-SERVICE] Loaded 19 premium fabrics from Supabase
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber Patch @ Back',
  'Leather Patch @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
âœ… [PRICING-SERVICE] Loaded 33 logo methods from Supabase
ğŸ¨ [LOGO] Processing: Rubber Patch Back Medium (+Mold Charge)
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber Patch" (Medium)
ğŸ”¥ [PRICING-SERVICE] Pre-warming cache with common data...
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
âœ… [PRICING-SERVICE] Loaded 3 mold charges from Supabase
ğŸ’° [LOGO] Using database mold charge: Medium = 80 for Rubber Patch
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 80,
  totalWithMold: 494.71999999999997
}
ğŸ¨ [LOGO] Processing: Leather Patch Front Large (+Mold Charge)
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather Patch" (Large)
ğŸ’° [LOGO] Using database mold charge: Large = 120 for Leather Patch
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 120,
  totalWithMold: 534.72
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 80,
      totalWithMold: 494.71999999999997
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 120,
      totalWithMold: 534.72
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    }
  ],
  totalCost: 1461.44,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [PRICING-SERVICE] Loaded 6 accessories from Supabase
âœ… [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
âœ… [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 3.29,
  totalCost: 473.76
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 2547.2, completedSections: 3 }
 POST /api/support-ai 200 in 2508ms
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: change quantity to 600 pieces
ğŸ” [ANALYZE] Conversation history length: 2
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: change quantity to 600 pieces
ğŸ’¬ History messages: 2
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 2 messages
ğŸ” [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…..."
ğŸ“‹ [EXTRACT] Found structured quote in message 1
ğŸ”¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
ğŸ”¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
ğŸ”¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢(7P\s+Elite\s+Seven\s+HFS\s*\(Tier\s+3\)) match: â€¢7P Elite Seven HFS (Tier 3)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*(?:Tier\s+\d)?) match: â€¢7P Elite Seven HFS (Tier 3)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*) match: â€¢7P Elite Seven HFS (Tier 3)
ğŸ§µ [EXTRACT] Fabrics from quote: Polyester
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-â€“]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
ğŸ¨ [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method:"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber: â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber: $80
âœ… [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
ğŸ¨ [EXTRACT] Processing conversation logo info: "Leather (Large)"
ğŸ¨ [EXTRACT] Fallback extraction: type="Leather", size="Large"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 "
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather: â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather: $120
âœ… [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Left: 3D Embroidery (Small) - $216.00"
ğŸ” [EXTRACT] Full content context (500 chars): "ase cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 ($3.29/cap)

ğŸ’° **Total Investment: $2547.20**
**Per Cap Cost"
ğŸ’° [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Right: 3D Embroidery (Small) - $216.00"
ğŸ” [EXTRACT] Full content context (500 chars): "â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 ($3.29/cap)

ğŸ’° **Total Investment: $2547.20**
**Per Cap Cost: $17.69**

ğŸ“Š **Cost Breakdown Per Cap:**
â€¢ Base C"
ğŸ’° [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-â€“]\s*(.+?)(?=\n|$)" found 4 matches
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method:"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber (Medium): â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($494.72 ($2.88/cap + $80.00 mold))
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 "
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather (Large): â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather (Large): $120
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($534.72 ($2.88/cap + $120.00 mold))
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ¨ [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "Accessories[^â€¢\n]*\n[\s\S]*?â€¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "(?:ğŸ·ï¸.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nğŸšš|\nï¿½..." found 0 matches
ğŸ” [EXTRACT] Found 0 accessory mentions in structured quote
ğŸ¨ [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ¨ [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
ğŸ¨ [EXTRACT] Testing color pattern "â€¢Color:\s*([^\n]+)...": 1 matches
ğŸ¨ [EXTRACT] Raw extracted color: Black/White
ğŸ¨ [EXTRACT] âœ… VALID color from structured quote: Black/White
ğŸ¨ [EXTRACT] Color found, stopping pattern search
ğŸ¨ [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
ğŸ¨ [EXTRACT] Final extracted colors: Black/White
ğŸ“Š [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ“Š [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
ğŸ“Š [EXTRACT] Calculated quantity: 612 Ã· 4.25 = 144
ğŸ“Š [EXTRACT] âœ… VALID quantity from structured quote: 144
ğŸ“Š [EXTRACT] Quantity found, stopping pattern search
ğŸ“Š [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
ğŸ“Š [EXTRACT] Final extracted quantity: 144
ğŸšš [EXTRACT] Delivery from quote: Regular Delivery
ğŸ’° [EXTRACT] Total cost from quote: 2547.2
ğŸ”„ [EXTRACT] Merging structured quote with user specifications
ğŸ”„ [EXTRACT] Latest complete specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ”„ [EXTRACT] User-specified changes: { quantity: 0 }
ğŸ”„ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 144
ğŸ“‹ [EXTRACT] Final merged specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ“‹ Previous specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ” [DETECT] Analyzing message for changes: change quantity to 600 pieces
ğŸ“‹ [DETECT] Previous specs for comparison: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ”¢ [DETECT] Quantity change detected: 144 -> 600
ğŸ” [DETECT] Total changes detected: 1
ğŸ” Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: 144, colors: 'Black/White', logos: 4, accessories: 0 }
ğŸ”§ [MERGE] Applied quantity change: 600
ğŸ”§ [MERGE] Preserving existing logos: 4
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] ULTRA-CRITICAL: Single aspect change detected (quantity) - ENFORCING preservation
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved colors (Black/White)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (2547.2)
ğŸ”§ [MERGE] SINGLE-ASPECT CHANGE (quantity:quantity) - Ensuring complete preservation
ğŸ”§ [MERGE] Force-preserved accessories for single-aspect change: []
ğŸ”§ [MERGE] Final logos preserved: Back:Rubber(Medium), Front:Leather(Large), Left:3D Embroidery(Small), Right:3D Embroidery(Small)
ğŸ”§ [MERGE] Final accessories preserved: none
ğŸ”§ [MERGE] Final fabric preserved: Polyester
ğŸ”§ [MERGE] Final colors preserved: Black/White
ğŸš¨ [MERGE] QUANTITY-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸš¨ [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
ğŸš¨ [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
ğŸš¨ [MERGE] FORCE-PRESERVED accessories: []
ğŸš¨ [MERGE] FORCE-PRESERVED colors: Black/White
ğŸš¨ [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
ğŸš¨ [MERGE] FORCE-PRESERVED totalCost: 2547.2
ğŸš¨ [MERGE] FORCE-PRESERVED colors for quantity change: Black/White
ğŸš¨ [MERGE] FORCE-PRESERVED logos: 4
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Black/White'
}
ğŸ”§ Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  â€¢ Back: ...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 144,
  previousLogos: 4,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  â€¢ Back: ...
ğŸ”¢ [QTY-FIX] Using quantity from context: 600
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: true,
  detectedChangeTypes: [ 'quantity' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Black/White',
  mergedColor: 'Black/White',
  finalColors: [ 'Black', 'White' ],
  finalColor: 'Black/White'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: Black/White Final colors: [ 'Black', 'White' ]
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
ğŸ¨ [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: true,
  preservedContext: {
    fabric: 'PRESERVED',
    closure: 'PRESERVED',
    logos: 'PRESERVED (4)',
    accessories: 'PRESERVED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: true,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Black/White',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 2547.2
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change quantity to 600 pieces"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Black/White\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  â€¢ Back: Rubber (Medium)\n' +
      '  â€¢ Front: Leather (Large)\n' +
      '  â€¢ Left: 3D Embroidery (Small)\n' +
      '  â€¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $2547.20\n' +
      '\n' +
      'Detected changes:\n' +
      'â€¢ Change quantity from 144 to 600 pieces (Medium confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: true,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 600
ğŸ’° [BLANK-CAP] Panel count requirement: 6P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 6P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 2
ğŸ¯ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
ğŸ¯ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
ğŸ¨ [LOGO] Processing: Rubber Back Medium 
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
ğŸ’° [LOGO] Using preserved mold charge from context: 80 for Rubber
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
ğŸ¨ [LOGO] Processing: Leather Front Large 
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
ğŸ’° [LOGO] Using preserved mold charge from context: 120 for Leather
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 32ms
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: change color to red/blue
ğŸ” [ANALYZE] Conversation history length: 4
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: change color to red/blue
ğŸ’¬ History messages: 4
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 4 messages
ğŸ” [EXTRACT-DEBUG] Message 3: role=assistant, content length=1239
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "I've updated your quote with the requested changes:

ğŸ”„ **Changes Applied:**
â€¢ Change quantity from 144 to 600 pieces

ğŸ’° **Cost Impact:** +$6100.80 increase (from $2547.20 to $8648.00)

Here's your d..."
ğŸ“‹ [EXTRACT] Found structured quote in message 3
ğŸ”¢ [EXTRACT] Found valid quantity: 2250 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
ğŸ”¢ [EXTRACT] Found valid quantity: 600 using pattern: (\d+,?\d*)\s*pieces?
ğŸ”¢ [EXTRACT] FINAL selected quantity: 2250 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 2
ğŸ”¢ [EXTRACT] All found quantities: [
  '2250 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)',
  '600 ((\\d+,?\\d*)\\s*pieces?)'
]
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢(6P\s+AirFrame\s+HSCS\s*\(Tier\s+2\)) match: â€¢6P AirFrame HSCS (Tier 2)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*(?:Tier\s+\d)?) match: â€¢6P AirFrame HSCS (Tier 2)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*) match: â€¢6P AirFrame HSCS (Tier 2)
ğŸ§µ [EXTRACT] Fabrics from quote: Polyester
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-â€“]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
ğŸ¨ [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Metho"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber: â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber: $80
âœ… [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
ğŸ¨ [EXTRACT] Processing conversation logo info: "Leather (Large)"
ğŸ¨ [EXTRACT] Fallback extraction: type="Leather", size="Large"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.0"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather: â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather: $120
âœ… [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Left: 3D Embroidery (Small) - $708.00"
ğŸ” [EXTRACT] Full content context (500 chars): " cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.00 ($2.71/cap)

ğŸ’° **Total Investment: $8648.00**
**Per Cap Cos"
ğŸ’° [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Right: 3D Embroidery (Small) - $708.00"
ğŸ” [EXTRACT] Full content context (500 chars): "**Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.00 ($2.71/cap)

ğŸ’° **Total Investment: $8648.00**
**Per Cap Cost: $14.41**

ğŸ“Š **Cost Breakdown Per Cap:**
â€¢ Base "
ğŸ’° [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-â€“]\s*(.+?)(?=\n|$)" found 4 matches
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Metho"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber (Medium): â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($1658.00 ($2.63/cap + $80.00 mold))
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.0"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather (Large): â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather (Large): $120
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($1698.00 ($2.63/cap + $120.00 mold))
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ¨ [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "Accessories[^â€¢\n]*\n[\s\S]*?â€¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "(?:ğŸ·ï¸.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nğŸšš|\nï¿½..." found 0 matches
ğŸ” [EXTRACT] Found 0 accessory mentions in structured quote
ğŸ¨ [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ¨ [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
ğŸ¨ [EXTRACT] Testing color pattern "â€¢Color:\s*([^\n]+)...": 1 matches
ğŸ¨ [EXTRACT] Raw extracted color: Black/White
ğŸ¨ [EXTRACT] âœ… VALID color from structured quote: Black/White
ğŸ¨ [EXTRACT] Color found, stopping pattern search
ğŸ¨ [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
ğŸ¨ [EXTRACT] Final extracted colors: Black/White
ğŸ“Š [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ“Š [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
ğŸ“Š [EXTRACT] Calculated quantity: 2250 Ã· 3.75 = 600
ğŸ“Š [EXTRACT] âœ… VALID quantity from structured quote: 600
ğŸ“Š [EXTRACT] Quantity found, stopping pattern search
ğŸ“Š [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
ğŸ“Š [EXTRACT] Final extracted quantity: 600
ğŸšš [EXTRACT] Delivery from quote: Regular Delivery
ğŸ’° [EXTRACT] Total cost from quote: 8648
ğŸ”„ [EXTRACT] Merging structured quote with user specifications
ğŸ”„ [EXTRACT] Latest complete specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ”„ [EXTRACT] User-specified changes: { quantity: 0 }
ğŸ”„ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 600
ğŸ“‹ [EXTRACT] Final merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ“‹ Previous specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ” [DETECT] Analyzing message for changes: change color to red/blue
ğŸ“‹ [DETECT] Previous specs for comparison: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ¨ [CONTEXT-SERVICE] === COLOR CHANGE DETECTION ===
ğŸ¨ [CONTEXT-SERVICE] Previous color: Black/White
ğŸ¨ [CONTEXT-SERVICE] New color: Red/Blue
ğŸ¨ [CONTEXT-SERVICE] Colors different?: true
ğŸ¨ [CONTEXT-SERVICE] RESULT: Color change detected: Black/White -> Red/Blue
ğŸ” [DETECT] Total changes detected: 1
ğŸ” Detected changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: 600, colors: 'Black/White', logos: 4, accessories: 0 }
ğŸ¨ [CONTEXT-SERVICE] === MERGING COLOR CHANGE ===
ğŸ¨ [CONTEXT-SERVICE] Previous colors: Black/White
ğŸ¨ [CONTEXT-SERVICE] New color value: Red/Blue
ğŸ¨ [CONTEXT-SERVICE] RESULT: Applied color change: Red/Blue
ğŸ¨ [CONTEXT-SERVICE] Final merged colors: Red/Blue
ğŸ”§ [MERGE] ULTRA-CRITICAL: Single aspect change detected (colors) - ENFORCING preservation
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved quantity (600)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (8648)
ğŸš¨ [MERGE] COLOR-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
ğŸš¨ [MERGE] FORCE-PRESERVED quantity: 600
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸš¨ [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
ğŸš¨ [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
ğŸš¨ [MERGE] FORCE-PRESERVED accessories: []
ğŸš¨ [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
ğŸš¨ [MERGE] FORCE-PRESERVED totalCost: 8648
ğŸš¨ [MERGE] FORCE-PRESERVED quantity for color change: 600
ğŸš¨ [MERGE] FORCE-PRESERVED logos: 4
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Red/Blue'
}
ğŸ”§ Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Red/Blue',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  â€¢ Back: Rubber (...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 600,
  previousLogos: 4,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  â€¢ Back: Rubber (...
ğŸ”¢ [QTY-FIX] Using quantity from context: 600
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'color' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Red/Blue',
  mergedColor: 'Black/White',
  finalColors: [ 'Red', 'Blue' ],
  finalColor: 'Red/Blue'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: Red/Blue Final colors: [ 'Red', 'Blue' ]
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
ğŸ¨ [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Red', 'Blue' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Red/Blue',
  colors: [ 'Red', 'Blue' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: false,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Red/Blue',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 8648
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change color to red/blue"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Red/Blue\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  â€¢ Back: Rubber (Medium)\n' +
      '  â€¢ Front: Leather (Large)\n' +
      '  â€¢ Left: 3D Embroidery (Small)\n' +
      '  â€¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $8648.00\n' +
      '\n' +
      'Detected changes:\n' +
      'â€¢ Change color from Black/White to Red/Blue (High confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 600
ğŸ’° [BLANK-CAP] Panel count requirement: 6P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 6P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 2
ğŸ¯ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
ğŸ¯ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
ğŸ¨ [LOGO] Processing: Rubber Back Medium 
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
ğŸ’° [LOGO] Using preserved mold charge from context: 80 for Rubber
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
ğŸ¨ [LOGO] Processing: Leather Front Large 
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
ğŸ’° [LOGO] Using preserved mold charge from context: 120 for Leather
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 20ms
âœ… [PRICING-SERVICE] Loaded 7 premium closures from Supabase
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $3.75 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $3.63 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.55 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.45 for 2880 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $4 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $3.75 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.63 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.5 for 2880 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $4.25 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $4 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.68 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.6 for 2880 units
âœ… [PRICING-SERVICE] Cache pre-warming completed
 âœ“ Compiled in 22ms
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
 âœ“ Compiled /api/support-ai in 197ms (107 modules)
ğŸš€ [PRICING-SERVICE] Ultra-fast pricing service initialized with intelligent caching
âœ… Supabase Admin: Using service role key for elevated permissions
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ” [ANALYZE] Conversation history length: 0
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ’¬ History messages: 0
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 0 messages
ğŸ“‹ [EXTRACT] No structured quote found, using user specifications only
ğŸ“‹ [EXTRACT] Final extracted specifications: { quantity: 0 }
ğŸ“‹ Previous specifications: { quantity: 0 }
ğŸ” [DETECT] Analyzing message for changes: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
ğŸ“‹ [DETECT] Previous specs for comparison: { quantity: 0 }
ğŸ”¢ [DETECT] Quantity change detected: 0 -> 144
ğŸ”¢ [DETECT] Quantity change detected: 0 -> 144
ğŸ” [DETECT] Total changes detected: 2
ğŸ” Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: { quantity: 0 }
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.85,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  },
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 0,
    newValue: 144,
    confidence: 0.8,
    changeDescription: 'Change quantity from 0 to 144 pieces'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: null, colors: undefined, logos: 0, accessories: 0 }
ğŸ”§ [MERGE] Applied quantity change: 144
ğŸ”§ [MERGE] Preserving existing logos: 0
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] Applied quantity change: 144
ğŸ”§ [MERGE] Preserving existing logos: 0
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 144,
  logos: 0,
  accessories: 0,
  fabric: undefined,
  colors: undefined
}
ğŸ”§ Merged specifications: { quantity: 144 }
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mol...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: false,
  hasContext: false,
  changesDetected: 2,
  previousQuantity: 0,
  previousLogos: 0,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: false, detectedChanges: 2, mergedSpecs: 1 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charg...
ğŸ”¢ [QTY-FIX] Using quantity from context: 144
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: false,
  isConversationalUpdate: false,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'quantity', 'quantity' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: false,
  mergedColors: undefined,
  mergedColor: undefined,
  finalColors: [ 'Black' ],
  finalColor: 'Black'
}
ğŸ¨ [FORMAT8-COLORS] === START EXTRACTING COLOR ===
ğŸ¨ [FORMAT8-COLORS] Input text: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.
ğŸ¨ [FORMAT8-COLORS] Slash pattern match: [
  'black/white',
  'black',
  'white',
  index: 80,
  input: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.',
  groups: undefined
]
ğŸ¨ [FORMAT8-COLORS] Split color parts: { part1: 'black', part2: 'white' }
ğŸ¨ [FORMAT8-COLORS] Color validation: { part1Valid: true, part2Valid: true }
ğŸ¨ [FORMAT8-COLORS] RESULT: Split color detected: Black/White
ğŸ¨ [ENHANCED-ANALYZE] Legacy color detection applied: {
  detectedColor: 'Black/White',
  colors: [ 'Black', 'White' ],
  color: 'Black/White'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: undefined Final colors: [ 'Black', 'White' ]
ğŸ“ [ADVANCED-SIZE] Standard size detected: { desc: 'medium', hatSize: '7 1/4' }
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: 7 1/4
ğŸš« [FABRIC-DETECTION] Skipping color pattern: black/white
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: undefined Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] 7-PANEL DETECTED from message: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 7P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: null
ğŸ” [UNIFIED-LOGO] Starting unified detection: I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac
ğŸ” [UNIFIED-LOGO] Searching for ALL logo patterns in text...
ğŸ¯ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "rubber patch" -> Rubber Patch
ğŸ“ [UNIFIED-LOGO] Position detected near "rubber patch" at index 102: Back
ğŸ“ [UNIFIED-LOGO] Size detected near "rubber patch" at index 102: Medium
âœ… [UNIFIED-LOGO] Added: Rubber Patch at Back (Medium) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 1 instance(s) of pattern: "leather patch" -> Leather Patch
ğŸ“ [UNIFIED-LOGO] Position detected near "leather patch" at index 155: Front
ğŸ“ [UNIFIED-LOGO] Size detected near "leather patch" at index 155: Large
âœ… [UNIFIED-LOGO] Added: Leather Patch at Front (Large) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "3d embroidery" -> 3D Embroidery
ğŸ“ [UNIFIED-LOGO] Position detected near "3d embroidery" at index 213: Left
ğŸ“ [UNIFIED-LOGO] Size detected near "3d embroidery" at index 213: Small
âœ… [UNIFIED-LOGO] Added: 3D Embroidery at Left (Small) - Confidence: 0.95
ğŸ“ [UNIFIED-LOGO] Position detected near "3d embroidery" at index 245: Right
ğŸ“ [UNIFIED-LOGO] Size detected near "3d embroidery" at index 245: Small
âœ… [UNIFIED-LOGO] Added: 3D Embroidery at Right (Small) - Confidence: 0.95
ğŸ¯ [UNIFIED-LOGO] Found 2 instance(s) of pattern: "embroidery" -> Embroidery
ğŸ“ [UNIFIED-LOGO] Position detected near "embroidery" at index 216: Left
âš ï¸ [UNIFIED-LOGO] Position Left already has logo - skipping duplicate
ğŸ“ [UNIFIED-LOGO] Position detected near "embroidery" at index 248: Right
âš ï¸ [UNIFIED-LOGO] Position Right already has logo - skipping duplicate
ğŸ¯ [UNIFIED-LOGO] Final results: {
  totalCount: 4,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ],
  summary: 'Back: Rubber Patch (Medium), Front: Leather Patch (Large), Left: 3D Embroidery (Small), Right: 3D Embroidery (Small)'
}
ğŸ¨ [LEGACY-ANALYZE] UNIFIED logo detection for new request: {
  totalCount: 4,
  hasLogos: true,
  logos: [
    { type: 'Rubber Patch', position: 'Back', size: 'Medium' },
    { type: 'Leather Patch', position: 'Front', size: 'Large' },
    { type: '3D Embroidery', position: 'Left', size: 'Small' },
    { type: '3D Embroidery', position: 'Right', size: 'Small' }
  ]
}
ğŸ·ï¸ [ACCESSORY-DETECTION] Accessories detected: {
  originalText: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  foundAccessories: []
}
ğŸ·ï¸ [LEGACY-ANALYZE] Advanced accessories detection for new request: {
  message: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add bac',
  detectedAccessories: [],
  uniqueCount: 0
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 144,
    fabric: 'Polyester',
    closure: null,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 144,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: '7 1/4',
  fabric: 'Polyester',
  panelCount: '7P',
  closure: null,
  capSpecifications: { panelCount: '7P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber Patch',
    location: 'Back',
    size: 'Medium',
    hasMoldCharge: true,
    priority: 2
  },
  allLogoRequirements: [
    {
      type: 'Rubber Patch',
      location: 'Back',
      size: 'Medium',
      hasMoldCharge: true,
      priority: 2
    },
    {
      type: 'Leather Patch',
      location: 'Front',
      size: 'Large',
      hasMoldCharge: true,
      priority: 1
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      hasMoldCharge: false,
      priority: 2
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: false,
    isConversationalUpdate: false,
    isQuantityUpdate: false,
    detectedChanges: [ [Object], [Object] ],
    mergedSpecifications: { quantity: 144 },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'I need a quote for 144 pieces, 7P Elite Seven HFS, polyester fabric, laser cut, black/white. Add back rubber patch medium size with $80 mold charge, front leather patch large size with $120 mold charge, left side 3D embroidery small, right side 3D embroidery small.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: false,
    closurePreserved: false,
    logosPreserved: false,
    accessoriesPreserved: false
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 144
ğŸ’° [BLANK-CAP] Panel count requirement: 7P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”§ [PRICING-SERVICE] Loading products from Supabase...
ğŸ”§ [PRICING-SERVICE] Initializing Supabase client: {
  url: 'https://tfiemrpfsvxv...',
  hasServiceKey: true,
  hasAnonKey: true,
  usingKey: 'SERVICE_ROLE'
}
âœ… [PRICING-SERVICE] Supabase client initialized successfully
âœ… [PRICING-SERVICE] Supabase client obtained
ğŸ” [PRICING-SERVICE] Query executed, checking results...
ğŸ“Š [PRICING-SERVICE] Raw query result: 77 products
ğŸ“‹ [PRICING-SERVICE] Sample product: {
  name: '4P Visor Cap MSCS',
  code: '4P_VISOR_CAP_MSCS',
  has_pricing_tier: true,
  tier_name: 'Tier 1'
}
âœ… [PRICING-SERVICE] Successfully loaded 77 products from Supabase
âœ… [PRICING-SERVICE] Loaded 3 pricing tiers from Supabase
ğŸ”„ [BLANK-CAP] Conversation context check: {
  hasContext: false,
  existingProduct: undefined,
  isConversationalUpdate: false
}
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 7P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 7-Panel detected -> Tier 3 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 3
ğŸ¯ [PRODUCT-SELECT] Found 13 products in Tier 3 : [
  '7P CrownFrame 7 LFF',
  '7P CrownFrame 7 LFS',
  '7P CrownFrame 7 MSCF',
  '7P CrownFrame 7 MSCS',
  '7P Elite Seven HFS',
  '7P Elite Seven HSCF',
  '7P Elite Seven HSCS',
  '7P Elite Seven LSCS',
  '7P Elite Seven MFS',
  '7P FlatFrame 7 HSCS',
  '7P Summit Seven HFF',
  '7P Summit Seven LSCF',
  '7P Summit Seven MFF'
]
ğŸ¯ [PRODUCT-SELECT] Selected Elite Seven product: 7P Elite Seven HFS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '7P Elite Seven HFS',
  code: '7P_ELITE_SEVEN_HFS',
  databaseTier: 'Tier 3',
  businessTier: 'Tier 3',
  panelCount: 7,
  databaseBillShape: 'Flat',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '7P Elite Seven HFS',
  tier: 'Tier 3',
  unitPrice: 4.25,
  totalCost: 612,
  quantity: 144
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '7P Elite Seven HFS',
  productCode: '7P_ELITE_SEVEN_HFS',
  panelCount: '7P',
  billShape: 'Flat',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 4.25,
  totalCost: 612,
  pricingTier: 'Tier 3',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Flat',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
âœ… [PRICING-SERVICE] Loaded 19 premium fabrics from Supabase
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber Patch @ Back',
  'Leather Patch @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
âœ… [PRICING-SERVICE] Loaded 33 logo methods from Supabase
ğŸ¨ [LOGO] Processing: Rubber Patch Back Medium (+Mold Charge)
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber Patch" (Medium)
ğŸ”¥ [PRICING-SERVICE] Pre-warming cache with common data...
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
âœ… [PRICING-SERVICE] Loaded 3 mold charges from Supabase
ğŸ’° [LOGO] Using database mold charge: Medium = 80 for Rubber Patch
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 80,
  totalWithMold: 494.71999999999997
}
ğŸ¨ [LOGO] Processing: Leather Patch Front Large (+Mold Charge)
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather Patch" (Large)
ğŸ’° [LOGO] Using database mold charge: Large = 120 for Leather Patch
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.88,
  totalCost: 414.71999999999997,
  moldCharge: 120,
  totalWithMold: 534.72
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.5,
  totalCost: 216,
  moldCharge: 0,
  totalWithMold: 216
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 80,
      totalWithMold: 494.71999999999997
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.88,
      totalCost: 414.71999999999997,
      moldCharge: 120,
      totalWithMold: 534.72
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.5,
      totalCost: 216,
      moldCharge: 0,
      totalWithMold: 216
    }
  ],
  totalCost: 1461.44,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
âœ… [PRICING-SERVICE] Loaded 6 accessories from Supabase
âœ… [PRICING-SERVICE] Loaded 7 premium closures from Supabase
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $3.75 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $3.63 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.55 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 4.5,
    price_144: 3.75,
    price_576: 3.63,
    price_1152: 3.55,
    price_2880: 3.45,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.45 for 2880 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $4 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $3.75 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.63 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 5.5,
    price_144: 4,
    price_576: 3.75,
    price_1152: 3.63,
    price_2880: 3.5,
    price_10000: 3.38,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.5 for 2880 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 288: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_144: $4.25 for 288 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 576: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_576: $4 for 576 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 1152: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_1152: $3.68 for 1152 units
ğŸ” [PRICING-SERVICE] Volume tier calculation for quantity 2880: {
  available_tiers: {
    price_48: 6,
    price_144: 4.25,
    price_576: 4,
    price_1152: 3.68,
    price_2880: 3.6,
    price_10000: 3.53,
    price_20000: undefined
  }
}
ğŸ’° [PRICING-SERVICE] Selected tier price_2880: $3.6 for 2880 units
âœ… [PRICING-SERVICE] Cache pre-warming completed
âœ… [PRICING-SERVICE] Loaded 4 delivery methods from Supabase
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 3.29,
  totalCost: 473.76
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 2547.2, completedSections: 3 }
 POST /api/support-ai 200 in 2789ms
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: change quantity to 600 pieces
ğŸ” [ANALYZE] Conversation history length: 2
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: change quantity to 600 pieces
ğŸ’¬ History messages: 2
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 2 messages
ğŸ” [EXTRACT-DEBUG] Message 1: role=assistant, content length=984
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "Here's your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…..."
ğŸ“‹ [EXTRACT] Found structured quote in message 1
ğŸ”¢ [EXTRACT] Found valid quantity: 612 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
ğŸ”¢ [EXTRACT] FINAL selected quantity: 612 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 1
ğŸ”¢ [EXTRACT] All found quantities: [
  '612 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)'
]
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢(7P\s+Elite\s+Seven\s+HFS\s*\(Tier\s+3\)) match: â€¢7P Elite Seven HFS (Tier 3)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*(?:Tier\s+\d)?) match: â€¢7P Elite Seven HFS (Tier 3)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*) match: â€¢7P Elite Seven HFS (Tier 3)
ğŸ§µ [EXTRACT] Fabrics from quote: Polyester
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-â€“]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
ğŸ¨ [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method:"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber: â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber: $80
âœ… [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
ğŸ¨ [EXTRACT] Processing conversation logo info: "Leather (Large)"
ğŸ¨ [EXTRACT] Fallback extraction: type="Leather", size="Large"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 "
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather: â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather: $120
âœ… [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Left: 3D Embroidery (Small) - $216.00"
ğŸ” [EXTRACT] Full content context (500 chars): "ase cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 ($3.29/cap)

ğŸ’° **Total Investment: $2547.20**
**Per Cap Cost"
ğŸ’° [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Right: 3D Embroidery (Small) - $216.00"
ğŸ” [EXTRACT] Full content context (500 chars): "â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 ($3.29/cap)

ğŸ’° **Total Investment: $2547.20**
**Per Cap Cost: $17.69**

ğŸ“Š **Cost Breakdown Per Cap:**
â€¢ Base C"
ğŸ’° [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-â€“]\s*(.+?)(?=\n|$)" found 4 matches
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method:"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber (Medium): â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($494.72 ($2.88/cap + $80.00 mold))
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢7P Elite Seven HFS (Tier 3)
â€¢Base cost: $612.00 ($4.25/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $494.72 ($2.88/cap + $80.00 mold)
â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $216.00 ($1.50/cap)
â€¢Right: 3D Embroidery (Small) - $216.00 ($1.50/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $473.76 "
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather (Large): â€¢Front: Leather (Large) - $534.72 ($2.88/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather (Large): $120
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($534.72 ($2.88/cap + $120.00 mold))
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ¨ [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "Accessories[^â€¢\n]*\n[\s\S]*?â€¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "(?:ğŸ·ï¸.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nğŸšš|\nï¿½..." found 0 matches
ğŸ” [EXTRACT] Found 0 accessory mentions in structured quote
ğŸ¨ [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ¨ [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
ğŸ¨ [EXTRACT] Testing color pattern "â€¢Color:\s*([^\n]+)...": 1 matches
ğŸ¨ [EXTRACT] Raw extracted color: Black/White
ğŸ¨ [EXTRACT] âœ… VALID color from structured quote: Black/White
ğŸ¨ [EXTRACT] Color found, stopping pattern search
ğŸ¨ [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
ğŸ¨ [EXTRACT] Final extracted colors: Black/White
ğŸ“Š [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ“Š [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
ğŸ“Š [EXTRACT] Calculated quantity: 612 Ã· 4.25 = 144
ğŸ“Š [EXTRACT] âœ… VALID quantity from structured quote: 144
ğŸ“Š [EXTRACT] Quantity found, stopping pattern search
ğŸ“Š [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
ğŸ“Š [EXTRACT] Final extracted quantity: 144
ğŸšš [EXTRACT] Delivery from quote: Regular Delivery
ğŸ’° [EXTRACT] Total cost from quote: 2547.2
ğŸ”„ [EXTRACT] Merging structured quote with user specifications
ğŸ”„ [EXTRACT] Latest complete specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ”„ [EXTRACT] User-specified changes: { quantity: 0 }
ğŸ”„ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 144
ğŸ“‹ [EXTRACT] Final merged specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ“‹ Previous specifications: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ” [DETECT] Analyzing message for changes: change quantity to 600 pieces
ğŸ“‹ [DETECT] Previous specs for comparison: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ”¢ [DETECT] Quantity change detected: 144 -> 600
ğŸ” [DETECT] Total changes detected: 1
ğŸ” Detected changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: {
  quantity: 144,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'quantity',
    aspect: 'quantity',
    oldValue: 144,
    newValue: 600,
    confidence: 0.85,
    changeDescription: 'Change quantity from 144 to 600 pieces'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: 144, colors: 'Black/White', logos: 4, accessories: 0 }
ğŸ”§ [MERGE] Applied quantity change: 600
ğŸ”§ [MERGE] Preserving existing logos: 4
ğŸ”§ [MERGE] Preserving existing accessories: 0
ğŸ”§ [MERGE] ULTRA-CRITICAL: Single aspect change detected (quantity) - ENFORCING preservation
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved colors (Black/White)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (2547.2)
ğŸ”§ [MERGE] SINGLE-ASPECT CHANGE (quantity:quantity) - Ensuring complete preservation
ğŸ”§ [MERGE] Force-preserved accessories for single-aspect change: []
ğŸ”§ [MERGE] Final logos preserved: Back:Rubber(Medium), Front:Leather(Large), Left:3D Embroidery(Small), Right:3D Embroidery(Small)
ğŸ”§ [MERGE] Final accessories preserved: none
ğŸ”§ [MERGE] Final fabric preserved: Polyester
ğŸ”§ [MERGE] Final colors preserved: Black/White
ğŸš¨ [MERGE] QUANTITY-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸš¨ [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
ğŸš¨ [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
ğŸš¨ [MERGE] FORCE-PRESERVED accessories: []
ğŸš¨ [MERGE] FORCE-PRESERVED colors: Black/White
ğŸš¨ [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
ğŸš¨ [MERGE] FORCE-PRESERVED totalCost: 2547.2
ğŸš¨ [MERGE] FORCE-PRESERVED colors for quantity change: Black/White
ğŸš¨ [MERGE] FORCE-PRESERVED logos: 4
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Black/White'
}
ğŸ”§ Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 2547.2
}
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  â€¢ Back: ...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 144,
  previousLogos: 4,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change quantity to 600 pieces"

Previous order specifications:
Quantity: 600 pieces
Colors: Black/White
Fabric: Polyester
Logos:
  â€¢ Back: ...
ğŸ”¢ [QTY-FIX] Using quantity from context: 600
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: true,
  detectedChangeTypes: [ 'quantity' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Black/White',
  mergedColor: 'Black/White',
  finalColors: [ 'Black', 'White' ],
  finalColor: 'Black/White'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: Black/White Final colors: [ 'Black', 'White' ]
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
ğŸ¨ [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: true,
  preservedContext: {
    fabric: 'PRESERVED',
    closure: 'PRESERVED',
    logos: 'PRESERVED (4)',
    accessories: 'PRESERVED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Black', 'White' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Black/White',
  colors: [ 'Black', 'White' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: true,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Black/White',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 2547.2
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change quantity to 600 pieces"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Black/White\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  â€¢ Back: Rubber (Medium)\n' +
      '  â€¢ Front: Leather (Large)\n' +
      '  â€¢ Left: 3D Embroidery (Small)\n' +
      '  â€¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $2547.20\n' +
      '\n' +
      'Detected changes:\n' +
      'â€¢ Change quantity from 144 to 600 pieces (Medium confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: true,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 600
ğŸ’° [BLANK-CAP] Panel count requirement: 6P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
ğŸ”„ [BLANK-CAP] Conversation context check: {
  hasContext: true,
  existingProduct: undefined,
  isConversationalUpdate: true
}
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 6P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 2
ğŸ¯ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
ğŸ¯ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
ğŸ¨ [LOGO] Processing: Rubber Back Medium 
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
ğŸ’° [LOGO] Using preserved mold charge from context: 80 for Rubber
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
ğŸ¨ [LOGO] Processing: Leather Front Large 
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
ğŸ’° [LOGO] Using preserved mold charge from context: 120 for Leather
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 32ms
ğŸ¯ [SUPPORT AI - FORMAT #8] Pure Format #8 pricing request
ğŸ”„ [FORMAT #8 DIRECT] Using Format #8 functions directly
ğŸ” [ANALYZE] Parsing customer message: change color to red/blue
ğŸ” [ANALYZE] Conversation history length: 4
ğŸ§  [CONTEXT-SERVICE] Starting intelligent context analysis
ğŸ“ Current message: change color to red/blue
ğŸ’¬ History messages: 4
ğŸ“‹ [EXTRACT-SPECS] Starting extraction from conversation history: 4 messages
ğŸ” [EXTRACT-DEBUG] Message 3: role=assistant, content length=1239
ğŸ” [EXTRACT-DEBUG] Assistant message preview: "I've updated your quote with the requested changes:

ğŸ”„ **Changes Applied:**
â€¢ Change quantity from 144 to 600 pieces

ğŸ’° **Cost Impact:** +$6100.80 increase (from $2547.20 to $8648.00)

Here's your d..."
ğŸ“‹ [EXTRACT] Found structured quote in message 3
ğŸ”¢ [EXTRACT] Found valid quantity: 2250 using pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\
ğŸ”¢ [EXTRACT] Found valid quantity: 600 using pattern: (\d+,?\d*)\s*pieces?
ğŸ”¢ [EXTRACT] FINAL selected quantity: 2250 from pattern: Base cost:\s*\$([\d,]+\.?\d*)\s*\(\$([\d.]+)\/cap\ total found: 2
ğŸ”¢ [EXTRACT] All found quantities: [
  '2250 (Base cost:\\s*\\$([\\d,]+\\.?\\d*)\\s*\\(\\$([\\d.]+)\\/cap\\)',
  '600 ((\\d+,?\\d*)\\s*pieces?)'
]
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢(6P\s+AirFrame\s+HSCS\s*\(Tier\s+2\)) match: â€¢6P AirFrame HSCS (Tier 2)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]*(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*(?:Tier\s+\d)?) match: â€¢6P AirFrame HSCS (Tier 2)
âš ï¸ [EXTRACT] Pattern matched but no capture group: â€¢([^â€¢\n]+(?:Panel|AirFrame|ProFit|Urban|Elite)[^â€¢\n]*) match: â€¢6P AirFrame HSCS (Tier 2)
ğŸ§µ [EXTRACT] Fabrics from quote: Polyester
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+?)\s*[-â€“]\s*\$[\d,]+\.?\d*(?:\s*\([^)]*\+\s*\$[\d.]+\s*mold\))?" found 4 matches
ğŸ¨ [EXTRACT] Processing conversation logo info: "Rubber (Medium)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="Rubber", size="Medium"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Metho"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber: â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber: $80
âœ… [EXTRACT] Added new logo: Back: Rubber (Medium) - mold charge: $80
ğŸ¨ [EXTRACT] Processing conversation logo info: "Leather (Large)"
ğŸ¨ [EXTRACT] Fallback extraction: type="Leather", size="Large"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.0"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather: â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather: $120
âœ… [EXTRACT] Added new logo: Front: Leather (Large) - mold charge: $120
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Left: 3D Embroidery (Small) - $708.00"
ğŸ” [EXTRACT] Full content context (500 chars): " cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.00 ($2.71/cap)

ğŸ’° **Total Investment: $8648.00**
**Per Cap Cos"
ğŸ’° [EXTRACT] Detected mold charge for Left 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ¨ [EXTRACT] Processing conversation logo info: "3D Embroidery (Small)"
ğŸ¨ [EXTRACT] Extracted from conversation: type="3D Embroidery", size="Small"
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: 3D Embroidery
ğŸ” [EXTRACT] Match text: "â€¢Right: 3D Embroidery (Small) - $708.00"
ğŸ” [EXTRACT] Full content context (500 chars): "**Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.00 ($2.71/cap)

ğŸ’° **Total Investment: $8648.00**
**Per Cap Cost: $14.41**

ğŸ“Š **Cost Breakdown Per Cap:**
â€¢ Base "
ğŸ’° [EXTRACT] Detected mold charge for Right 3D Embroidery: $0
âœ… [EXTRACT] Added new logo: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills):\s*([^-\n]+)\s*[-â€“]\s*(.+?)(?=\n|$)" found 4 matches
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Rubber (Medium)
ğŸ” [EXTRACT] Match text: "â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "'s your detailed quote with verified pricing from our database:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Metho"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Rubber (Medium): â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $80 for Rubber (Medium)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $80
ğŸ’° [EXTRACT] Detected mold charge for Back Rubber (Medium): $80
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Back", baseType: "rubber"} vs new={position: "Back", baseType: "rubber"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Back: Rubber (Medium) ($1658.00 ($2.63/cap + $80.00 mold))
ğŸ” [EXTRACT] Calling detectMoldChargeFromMatch for: Leather (Large)
ğŸ” [EXTRACT] Match text: "â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)"
ğŸ” [EXTRACT] Full content context (500 chars): "se:

ğŸ“Š **Cap Style Setup** âœ…
â€¢6P AirFrame HSCS (Tier 2)
â€¢Base cost: $2250.00 ($3.75/cap)
â€¢Color: Black/White

â­ **Premium Upgrades** âœ…
â€¢Polyester: (+$0.00) ($0.00/cap)

ğŸ¨ **Logo Setup** âœ…
â€¢Back: Rubber (Medium) - $1658.00 ($2.63/cap + $80.00 mold)
â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
â€¢Left: 3D Embroidery (Small) - $708.00 ($1.18/cap)
â€¢Right: 3D Embroidery (Small) - $708.00 ($1.18/cap)

ğŸšš **Delivery** âœ…
â€¢Method: Regular Delivery
â€¢Timeline: 6-10 days days
â€¢Cost: $1626.0"
ğŸ’° [MOLD-CHARGE] Analyzing match text for Leather (Large): â€¢Front: Leather (Large) - $1698.00 ($2.63/cap + $120.00 mold)
ğŸ’° [MOLD-CHARGE] Fixed mold charge detected: $120 for Leather (Large)
ğŸ’° [MOLD-CHARGE] Using fixed mold charge: $120
ğŸ’° [EXTRACT] Detected mold charge for Front Leather (Large): $120
ğŸ” [EXTRACT] Duplicate check BLOCKED: existing={position: "Front", baseType: "leather"} vs new={position: "Front", baseType: "leather"}
âš ï¸ [EXTRACT] PREVENTED duplicate logo: Front: Leather (Large) ($1698.00 ($2.63/cap + $120.00 mold))
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(?:Logo)?:\s*([^-\n]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Embroidery|Print|Patch):\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢(Front|Back|Left|Right|Bills)\s*(Screen\s*Print|Rubber\s*Patch|Leather\s*Patch|Woven\s*Patch|3D\s*Embroidery|Flat\s*Embroidery|Sublimation)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 0 matches
ğŸ” [EXTRACT] Logo pattern "â€¢([^:]+):\s*([^(]+)\s*\(([^)]+)\)\s*[-â€“]\s*\$[\d,]+\.?\d*" found 4 matches
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Back: Rubber (Medium) - mold charge: $80
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Back',
  type: 'Rubber',
  size: 'Medium',
  application: 'Direct',
  moldCharge: 80,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Front: Leather (Large) - mold charge: $120
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Front',
  type: 'Leather',
  size: 'Large',
  application: 'Direct',
  moldCharge: 120,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Left: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Left',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ”„ [EXTRACT] COMPLETE PRESERVATION - keeping existing logo unchanged: Right: 3D Embroidery (Small) - mold charge: $0
ğŸ”„ [EXTRACT] Preserved logo data: {
  position: 'Right',
  type: '3D Embroidery',
  size: 'Small',
  application: 'Direct',
  moldCharge: 0,
  hasMoldCharge: false
}
ğŸ¨ [EXTRACT] Final logos from quote: [
  'Back: Rubber (Medium)',
  'Front: Leather (Large)',
  'Left: 3D Embroidery (Small)',
  'Right: 3D Embroidery (Small)'
]
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "â€¢\s*(Hang\s*Tag|Inside\s*Label|B-Tape\s*Print|B-Ta..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "Accessories[^â€¢\n]*\n[\s\S]*?â€¢\s*([^:\n]*(?:Hang\s*..." found 0 matches
ğŸ” [EXTRACT] Accessory pattern "(?:ğŸ·ï¸.*Accessories.*\n)([\s\S]*?)(?:\n\n|\nğŸšš|\nï¿½..." found 0 matches
ğŸ” [EXTRACT] Found 0 accessory mentions in structured quote
ğŸ¨ [EXTRACT] === ENHANCED COLOR EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ¨ [EXTRACT] Testing color pattern "Current AI Values[\s\S]*?Color:\s*([^\n]+)...": 0 matches
ğŸ¨ [EXTRACT] Testing color pattern "â€¢Color:\s*([^\n]+)...": 1 matches
ğŸ¨ [EXTRACT] Raw extracted color: Black/White
ğŸ¨ [EXTRACT] âœ… VALID color from structured quote: Black/White
ğŸ¨ [EXTRACT] Color found, stopping pattern search
ğŸ¨ [EXTRACT] === FINAL COLOR EXTRACTION RESULT ===
ğŸ¨ [EXTRACT] Final extracted colors: Black/White
ğŸ“Š [EXTRACT] === ENHANCED QUANTITY EXTRACTION FROM STRUCTURED QUOTE ===
ğŸ“Š [EXTRACT] Testing quantity pattern "Base cost:\s*\$?([\d,]+\.?\d*)\s*\(\$?([\d.]+)\/ca...": 1 matches
ğŸ“Š [EXTRACT] Calculated quantity: 2250 Ã· 3.75 = 600
ğŸ“Š [EXTRACT] âœ… VALID quantity from structured quote: 600
ğŸ“Š [EXTRACT] Quantity found, stopping pattern search
ğŸ“Š [EXTRACT] === FINAL QUANTITY EXTRACTION RESULT ===
ğŸ“Š [EXTRACT] Final extracted quantity: 600
ğŸšš [EXTRACT] Delivery from quote: Regular Delivery
ğŸ’° [EXTRACT] Total cost from quote: 8648
ğŸ”„ [EXTRACT] Merging structured quote with user specifications
ğŸ”„ [EXTRACT] Latest complete specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ”„ [EXTRACT] User-specified changes: { quantity: 0 }
ğŸ”„ [EXTRACT] MANDATORY PRESERVED quantity from structured quote: 600
ğŸ“‹ [EXTRACT] Final merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ“‹ Previous specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ” [DETECT] Analyzing message for changes: change color to red/blue
ğŸ“‹ [DETECT] Previous specs for comparison: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ¨ [CONTEXT-SERVICE] === COLOR CHANGE DETECTION ===
ğŸ¨ [CONTEXT-SERVICE] Previous color: Black/White
ğŸ¨ [CONTEXT-SERVICE] New color: Red/Blue
ğŸ¨ [CONTEXT-SERVICE] Colors different?: true
ğŸ¨ [CONTEXT-SERVICE] RESULT: Color change detected: Black/White -> Red/Blue
ğŸ” [DETECT] Total changes detected: 1
ğŸ” Detected changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
ğŸ”§ [MERGE] Starting with previous specs: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Black/White',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ”§ [MERGE] Applying changes: [
  {
    type: 'color',
    aspect: 'colors',
    oldValue: 'Black/White',
    newValue: 'Red/Blue',
    confidence: 0.95,
    changeDescription: 'Change color from Black/White to Red/Blue'
  }
]
ğŸ”§ [MERGE] Preserved critical values: { quantity: 600, colors: 'Black/White', logos: 4, accessories: 0 }
ğŸ¨ [CONTEXT-SERVICE] === MERGING COLOR CHANGE ===
ğŸ¨ [CONTEXT-SERVICE] Previous colors: Black/White
ğŸ¨ [CONTEXT-SERVICE] New color value: Red/Blue
ğŸ¨ [CONTEXT-SERVICE] RESULT: Applied color change: Red/Blue
ğŸ¨ [CONTEXT-SERVICE] Final merged colors: Red/Blue
ğŸ”§ [MERGE] ULTRA-CRITICAL: Single aspect change detected (colors) - ENFORCING preservation
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved quantity (600)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabric (Polyester)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved fabrics (1 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved logos (4 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved accessories (0 items)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved color (Black/White)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved deliveryMethod (Regular Delivery)
ğŸ”§ [MERGE] ULTRA-CRITICAL: Force-preserved totalCost (8648)
ğŸš¨ [MERGE] COLOR-ONLY CHANGE DETECTED - FORCING COMPLETE PRESERVATION
ğŸš¨ [MERGE] FORCE-PRESERVED quantity: 600
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸš¨ [MERGE] FORCE-PRESERVED fabrics: [ 'Polyester' ]
ğŸš¨ [MERGE] FORCE-PRESERVED logos: [
  {
    position: 'Back',
    type: 'Rubber',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80,
    hasMoldCharge: false
  },
  {
    position: 'Front',
    type: 'Leather',
    size: 'Large',
    application: 'Direct',
    moldCharge: 120,
    hasMoldCharge: false
  },
  {
    position: 'Left',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  },
  {
    position: 'Right',
    type: '3D Embroidery',
    size: 'Small',
    application: 'Direct',
    moldCharge: 0,
    hasMoldCharge: false
  }
]
ğŸš¨ [MERGE] FORCE-PRESERVED accessories: []
ğŸš¨ [MERGE] FORCE-PRESERVED deliveryMethod: Regular Delivery
ğŸš¨ [MERGE] FORCE-PRESERVED totalCost: 8648
ğŸš¨ [MERGE] FORCE-PRESERVED quantity for color change: 600
ğŸš¨ [MERGE] FORCE-PRESERVED logos: 4
ğŸš¨ [MERGE] FORCE-PRESERVED fabric: Polyester
ğŸ”§ [MERGE] Final merged specifications (with mandatory preservation): {
  quantity: 600,
  logos: 4,
  accessories: 0,
  fabric: 'Polyester',
  colors: 'Red/Blue'
}
ğŸ”§ Merged specifications: {
  quantity: 600,
  fabric: 'Polyester',
  fabrics: [ 'Polyester' ],
  logos: [
    {
      position: 'Back',
      type: 'Rubber',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80,
      hasMoldCharge: false
    },
    {
      position: 'Front',
      type: 'Leather',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120,
      hasMoldCharge: false
    },
    {
      position: 'Left',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    },
    {
      position: 'Right',
      type: '3D Embroidery',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0,
      hasMoldCharge: false
    }
  ],
  accessories: [],
  colors: 'Red/Blue',
  color: 'Black/White',
  deliveryMethod: 'Regular Delivery',
  totalCost: 8648
}
ğŸ“ [CONTEXTUAL-REQUEST] Built contextual request: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  â€¢ Back: Rubber (...
ğŸ§  [CONTEXT-SERVICE] Context decision: {
  hasMeaningfulContext: true,
  hasContext: true,
  changesDetected: 1,
  previousQuantity: 600,
  previousLogos: 4,
  previousAccessories: 0
}
ğŸ§  [ENHANCED-CONTEXT] Smart context analysis: { hasContext: true, detectedChanges: 1, mergedSpecs: 9 }
ğŸ“ [ENHANCED-CONTEXT] Using contextual message: CONVERSATIONAL UPDATE REQUEST:

Customer's current message: "change color to red/blue"

Previous order specifications:
Quantity: 600 pieces
Colors: Red/Blue
Fabric: Polyester
Logos:
  â€¢ Back: Rubber (...
ğŸ”¢ [QTY-FIX] Using quantity from context: 600
ğŸ”„ [ENHANCED-ANALYZE] Conversational analysis: {
  hasContext: true,
  isConversationalUpdate: true,
  isQuantityUpdate: false,
  detectedChangeTypes: [ 'color' ]
}
ğŸ¨ [ENHANCED-ANALYZE] Color processing: {
  hasContext: true,
  mergedColors: 'Red/Blue',
  mergedColor: 'Black/White',
  finalColors: [ 'Red', 'Blue' ],
  finalColor: 'Red/Blue'
}
ğŸ¨ [ENHANCED-ANALYZE] Colors - Merged specs: Red/Blue Final colors: [ 'Red', 'Blue' ]
ğŸ“ [ENHANCED-ANALYZE] Size - Merged specs: undefined Final size: Large
ğŸ§µ [ENHANCED-ANALYZE] Fabric - Merged specs: Polyester Final fabric: Polyester
ğŸ¯ [PANEL-DETECTION] No specific panel count detected, defaulting to 6P
ğŸ¯ [ENHANCED-ANALYZE] Panel count - Merged specs: undefined Final: 6P
ğŸ¯ [ENHANCED-ANALYZE] Bill shape - Merged specs: undefined Detected: null
ğŸ”’ [ENHANCED-ANALYZE] Closure - Merged specs: undefined Final closure: undefined
ğŸ¨ [ENHANCED-ANALYZE] Using logos from merged specs: {
  logoCount: 4,
  logos: [
    { type: 'Rubber', location: 'Back', size: 'Medium' },
    { type: 'Leather', location: 'Front', size: 'Large' },
    { type: '3D Embroidery', location: 'Left', size: 'Small' },
    { type: '3D Embroidery', location: 'Right', size: 'Small' }
  ]
}
âœ… [ANALYZE] FINAL ANALYSIS COMPLETE: {
  isQuantityUpdate: false,
  preservedContext: {
    fabric: 'DETECTED',
    closure: 'DETECTED',
    logos: 'DETECTED (4)',
    accessories: 'DETECTED (0)'
  },
  finalValues: {
    quantity: 600,
    fabric: 'Polyester',
    closure: undefined,
    logoCount: 4,
    accessoryCount: 0,
    colors: [ 'Red', 'Blue' ]
  }
}
ğŸ“‹ [STEP-1] Customer requirements analyzed: {
  quantity: 600,
  color: 'Red/Blue',
  colors: [ 'Red', 'Blue' ],
  size: 'Large',
  fabric: 'Polyester',
  panelCount: '6P',
  closure: undefined,
  capSpecifications: { panelCount: '6P' },
  billStyle: null,
  logoRequirement: {
    type: 'Rubber',
    location: 'Back',
    size: 'Medium',
    application: 'Direct',
    moldCharge: 80
  },
  allLogoRequirements: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      application: 'Direct',
      moldCharge: 80
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      application: 'Direct',
      moldCharge: 120
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      application: 'Direct',
      moldCharge: 0
    }
  ],
  accessoriesRequirements: [],
  conversationalContext: {
    hasContext: true,
    isConversationalUpdate: true,
    isQuantityUpdate: false,
    detectedChanges: [ [Object] ],
    mergedSpecifications: {
      quantity: 600,
      fabric: 'Polyester',
      fabrics: [Array],
      logos: [Array],
      accessories: [],
      colors: 'Red/Blue',
      color: 'Black/White',
      deliveryMethod: 'Regular Delivery',
      totalCost: 8648
    },
    orderBuilderDelta: {
      changedSections: [Array],
      costImpact: [Object],
      visualIndicators: [Object]
    },
    effectiveMessage: 'CONVERSATIONAL UPDATE REQUEST:\n' +
      '\n' +
      `Customer's current message: "change color to red/blue"\n` +
      '\n' +
      'Previous order specifications:\n' +
      'Quantity: 600 pieces\n' +
      'Colors: Red/Blue\n' +
      'Fabric: Polyester\n' +
      'Logos:\n' +
      '  â€¢ Back: Rubber (Medium)\n' +
      '  â€¢ Front: Leather (Large)\n' +
      '  â€¢ Left: 3D Embroidery (Small)\n' +
      '  â€¢ Right: 3D Embroidery (Small)\n' +
      'Delivery: Regular Delivery\n' +
      'Previous Total: $8648.00\n' +
      '\n' +
      'Detected changes:\n' +
      'â€¢ Change color from Black/White to Red/Blue (High confidence)\n' +
      '\n' +
      'INSTRUCTION: Apply ONLY the detected changes while preserving ALL other specifications from the previous order. Provide a complete quote with the updated specifications.'
  },
  isQuantityUpdate: false,
  contextPreservation: {
    fabricPreserved: true,
    closurePreserved: true,
    logosPreserved: true,
    accessoriesPreserved: true
  }
}
ğŸ’° [BLANK-CAP] Fetching costs for quantity: 600
ğŸ’° [BLANK-CAP] Panel count requirement: 6P
ğŸ’° [BLANK-CAP] User bill shape input: null
ğŸ”„ [PRICING-SERVICE] Using cached products: 77 items
ğŸ”„ [BLANK-CAP] Conversation context check: {
  hasContext: true,
  existingProduct: undefined,
  isConversationalUpdate: true
}
ğŸ¯ [PRICING-TIER] Determining tier based on business logic
ğŸ¯ [PRICING-TIER] Panel count: 6P
ğŸ¯ [PRICING-TIER] Bill style: null
ğŸ¯ [PRICING-TIER] 6-Panel default -> Tier 2 (business rule)
ğŸ¯ [PRODUCT-SELECT] Looking for products in Tier 2
ğŸ¯ [PRODUCT-SELECT] Found 48 products in Tier 2 : [
  '5P Heritage Five HFU',  '5P Heritage Five HSCF',
  '5P Heritage Five HSCU', '5P Heritage Five LFU',
  '5P Heritage Five LSCU', '5P Heritage Five MFF',
  '5P StreetFrame HFF',    '5P StreetFrame MSCF',
  '5P StreetFrame MSCS',   '5P StreetFrame MSCU',
  '5P Urban Classic HFS',  '5P Urban Classic HSCS',
  '5P Urban Classic LFF',  '5P Urban Classic LFS',
  '5P Urban Classic LSCF', '5P Urban Classic LSCS',
  '5P Urban Classic MFS',  '5P Urban Classic MFU',
  '6P AirFrame HFU',       '6P AirFrame HSCF',
  '6P AirFrame HSCS',      '6P AirFrame HSCU',
  '6P AirFrame LFF',       '6P AirFrame LSCF',
  '6P AirFrame LSCU',      '6P AirFrame MFF',
  '6P AirFrame MFS',       '6P Heritage 6C HFF',
  '6P Heritage 6C HFS',    '6P Heritage 6C HSCF',
  '6P Heritage 6C HSCU',   '6P Heritage 6C LCF',
  '6P Heritage 6C LCS',    '6P Heritage 6C LCU',
  '6P Heritage 6C LSCU',   '6P Heritage 6C MSCF',
  '6P ProFit Six HFF',     '6P ProFit Six HFS',
  '6P ProFit Six HFU',     '6P ProFit Six LFS',
  '6P ProFit Six LFU',     '6P ProFit Six LSCF',
  '6P ProFit Six LSCS',    '6P ProFit Six MFF',
  '6P ProFit Six MFU',     '6P ProFit Six MSCF',
  '6P ProFit Six MSCS',    '6P ProFit Six MSCU'
]
ğŸ¯ [PRODUCT-SELECT] Selected structured AirFrame product: 6P AirFrame HSCS
ğŸ¯ [BLANK-CAP] Final product selection: {
  name: '6P AirFrame HSCS',
  code: '6P_AIRFRAME_HSCS',
  databaseTier: 'Tier 2',
  businessTier: 'Tier 2',
  panelCount: 6,
  databaseBillShape: 'Slight Curved',
  userBillShape: null
}
ğŸ’° [BLANK-CAP] Pricing calculated: {
  product: '6P AirFrame HSCS',
  tier: 'Tier 2',
  unitPrice: 3.75,
  totalCost: 2250,
  quantity: 600
}
âœ… [STEP-2] Blank cap costs fetched: {
  productName: '6P AirFrame HSCS',
  productCode: '6P_AIRFRAME_HSCS',
  panelCount: '6P',
  billShape: 'Slight Curved',
  profile: 'High',
  structure: 'Structured with Mono Lining',
  unitPrice: 3.75,
  totalCost: 2250,
  pricingTier: 'Tier 2',
  _debug: {
    userBillShapeInput: null,
    databaseBillShape: 'Slight Curved',
    preservedUserInput: false
  }
}
â­ [PREMIUM] Fetching premium upgrades
ğŸ§µ [PREMIUM] Processing fabric requirement: Polyester
ğŸ§µ [PREMIUM] Processing fabric types: [ 'Polyester' ]
ğŸ” [PREMIUM] Looking for fabric: Polyester -> Polyester
âœ… [PREMIUM] Found premium fabric: Cotton Polyester Mix - $0/cap ($0 total)
âœ… [PREMIUM] Total fabric cost: 0 for fabrics: [ 'Polyester' ]
â­ [PREMIUM] Final upgrades: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
âœ… [STEP-3] Premium upgrades fetched: {
  fabric: { name: 'Polyester', unitPrice: 0, totalCost: 0 },
  fabrics: {
    Polyester: { type: 'Cotton Polyester Mix', unitPrice: 0, cost: 0 }
  },
  closure: null,
  totalCost: 0
}
ğŸ¨ [LOGO] Fetching logo setup costs
ğŸ¨ [LOGO] Processing 4 logo(s): [
  'Rubber @ Back',
  'Leather @ Front',
  '3D Embroidery @ Left',
  '3D Embroidery @ Right'
]
ğŸ¨ [LOGO] Processing: Rubber Back Medium 
âœ… [LOGO-MATCH] Found: "Rubber" (Medium) matches "Rubber" (Medium)
ğŸ’° [LOGO] Using preserved mold charge from context: 80 for Rubber
âœ… [LOGO] Processed: {
  type: 'Rubber',
  location: 'Back',
  size: 'Medium',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 80,
  totalWithMold: 1658
}
ğŸ¨ [LOGO] Processing: Leather Front Large 
âœ… [LOGO-MATCH] Found: "Leather" (Large) matches "Leather" (Large)
ğŸ’° [LOGO] Using preserved mold charge from context: 120 for Leather
âœ… [LOGO] Processed: {
  type: 'Leather',
  location: 'Front',
  size: 'Large',
  unitPrice: 2.63,
  totalCost: 1578,
  moldCharge: 120,
  totalWithMold: 1698
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Left Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Left',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
ğŸ¨ [LOGO] Processing: 3D Embroidery Right Small 
âœ… [LOGO-MATCH] Found: "3D Embroidery" (Small) matches "3D Embroidery" (Small)
âœ… [LOGO] Processed: {
  type: '3D Embroidery',
  location: 'Right',
  size: 'Small',
  unitPrice: 1.18,
  totalCost: 708,
  moldCharge: 0,
  totalWithMold: 708
}
âœ… [STEP-4] Logo setup costs fetched: {
  logos: [
    {
      type: 'Rubber',
      location: 'Back',
      size: 'Medium',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 80,
      totalWithMold: 1658
    },
    {
      type: 'Leather',
      location: 'Front',
      size: 'Large',
      unitPrice: 2.63,
      totalCost: 1578,
      moldCharge: 120,
      totalWithMold: 1698
    },
    {
      type: '3D Embroidery',
      location: 'Left',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    },
    {
      type: '3D Embroidery',
      location: 'Right',
      size: 'Small',
      unitPrice: 1.18,
      totalCost: 708,
      moldCharge: 0,
      totalWithMold: 708
    }
  ],
  totalCost: 4772,
  summary: 'Back: Rubber (Medium) +$80 mold | Front: Leather (Large) +$120 mold | Left: 3D Embroidery (Small) | Right: 3D Embroidery (Small)'
}
ğŸ·ï¸ [ACCESSORIES] Fetching accessories costs
ğŸ·ï¸ [ACCESSORIES] No accessories requirements found
âœ… [STEP-5] Accessories costs fetched: { items: [], totalCost: 0 }
ğŸšš [DELIVERY] Fetching delivery costs
âœ… [STEP-6] Delivery costs fetched: {
  method: 'Regular Delivery',
  leadTime: '6-10 days days',
  unitPrice: 2.71,
  totalCost: 1626
}
âœ… [FORMAT #8 DIRECT] Format #8 response generated
ğŸ”„ [TRANSFORM] Converting Format #8 to Order Builder structure
âœ… [TRANSFORM] Order Builder structure created: { totalCost: 8648, completedSections: 3 }
 POST /api/support-ai 200 in 23ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 4.6s (1652 modules)
ğŸ—ï¸ AuthProvider: Rendering - isHydrated: false loading: true
 POST /api/support-ai 404 in 5690ms
 âœ“ Compiled in 1088ms (781 modules)
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
 âœ“ Compiled in 32ms
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":46,"hitCount":23,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
ğŸ§¹ [PRICING-SERVICE] Cache stats: {"hitRate":55.00000000000001,"hitCount":33,"missCount":27,"cacheSize":26,"memoryUsage":"0.22 MB"}
