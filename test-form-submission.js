const fetch = require("node-fetch"); require("dotenv").config(); async function testFormSubmission() { console.log("🧪 Testing form submission API..."); const testData = { formType: "CONTACT", name: "Test User", email: "test@example.com", subject: "custom-order", message: "This is a test message from the form submission test script.", phone: "+1234567890", company: "Test Company", metadata: { source: "test_script", timestamp: new Date().toISOString() } }; try { console.log("📤 Sending test form submission..."); const response = await fetch("http://localhost:3001/api/form-submissions", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(testData) }); const result = await response.json(); if (response.ok) { console.log("✅ Form submission successful\!"); console.log("📝 Submission ID:", result.submissionId); console.log("📧 Response:", result.message); } else { console.log("❌ Form submission failed\!"); console.log("Status:", response.status); console.log("Error:", result); } console.log("\n📥 Testing form submissions retrieval..."); const getResponse = await fetch("http://localhost:3001/api/form-submissions?limit=5"); const getResult = await getResponse.json(); if (getResponse.ok) { console.log("✅ Form submissions retrieved successfully\!"); console.log("📊 Total submissions:", getResult.pagination?.total || 0); console.log("📄 Current page submissions:", getResult.submissions?.length || 0); if (getResult.submissions && getResult.submissions.length > 0) { console.log("📋 Latest submission:", { id: getResult.submissions[0].id, name: getResult.submissions[0].name, email: getResult.submissions[0].email, formType: getResult.submissions[0].formType, status: getResult.submissions[0].status, createdAt: getResult.submissions[0].createdAt }); } } else { console.log("❌ Failed to retrieve form submissions\!"); console.log("Status:", getResponse.status); console.log("Error:", getResult); } } catch (error) { console.log("💥 Test failed with error:", error.message); if (error.code === "ECONNREFUSED") { console.log("\n🚨 Make sure the Next.js development server is running:"); console.log("   npm run dev"); } } } testFormSubmission();
